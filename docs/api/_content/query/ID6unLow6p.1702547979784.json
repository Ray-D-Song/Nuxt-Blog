{"_path":"/1701870426245","_dir":"","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Vue 使用 Vitest进行单元测试","description":"笔者过去并没有写过前端单测, 只在例如 Go 这样社区大力推崇 TDD 的语言中实践过, 最近遇到很多前端通过人肉测试难以覆盖的场景, 因此尝试 vitest.","cover":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312141754429.png","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"单元测试的定义"},"children":[{"type":"text","value":"单元测试的定义"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"单元测试（英语：Unit Testing）又称为模块测试 "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"来源请求"}]},{"type":"text","value":" ，是针对程序模块（软件设计的最小单位）来进行正确性检验的测试工作。程序单元是应用的最小可测试部件。在过程化编程中，一个单元就是单个程序、函数、过程等；对于面向对象编程，最小单元就是方法，包括基类（超类）、抽象类、或者派生类（子类）中的方法。     ———wiki"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在一个典型的 Vue 项目中, 我们经常需要进行单元测试的模块包括以下几种:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hooks"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"工具函数 (utils)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"校验规则 (reg)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"脚手架 (bin/scaffold)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"自定义 vue 指令"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"全局状态 (store)"}]}]},{"type":"element","tag":"h1","props":{"id":"初始化-vitest"},"children":[{"type":"text","value":"初始化 Vitest"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"安装 Vitest"}]},{"type":"element","tag":"code","props":{"className":["language-bash"],"code":"pnpm add -D vitest\n","language":"bash","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"pnpm"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"add"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"-D"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"vitest"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vitest 默认和 Vite 配置集成, 不需要额外的配置文件."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n修改"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"package.json"}]},{"type":"text","value":", 在"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"script"}]},{"type":"text","value":"下新增"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"test:unit"}]},{"type":"text","value":"命令"}]},{"type":"element","tag":"code","props":{"className":["language-json"],"code":"  \"scripts\": {\n    ...\n    \"test:unit\": \"vitest\",\n  },\n","language":"json","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"scripts\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":": {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-338738"},"children":[{"type":"text","value":"...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"\"test:unit\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"vitest\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  },"}]}]}]}]}]},{"type":"element","tag":"h1","props":{"id":"编写测试用例"},"children":[{"type":"text","value":"编写测试用例"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"测试一个手机号校验函数"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /reg/phone.ts */\n// 校验是否国内手机号\nexport function regChinesePhoneNumber(phoneNumber: string) {\n  const regex = /^1[3456789]\\d{9}$/\n  return regex.test(phoneNumber)\n}\n\n/** /reg/phone.test.ts */\nimport { describe, expect, test } from 'vitest'\nimport { regChinesePhoneNumber } from '../phone'\n\ndescribe('phone', () => {\n  test('phone number belongs to Chinese', () => {\n    expect(regChinesePhoneNumber('17725663831')).toBe(true)\n  })\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /reg/phone.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 校验是否国内手机号\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"regChinesePhoneNumber"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"phoneNumber"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"regex"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-273446"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"^"}]},{"type":"element","tag":"span","props":{"class":"ct-273446"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"[3456789]\\d"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"{9}$"}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"/\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" regex."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(phoneNumber)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /reg/phone.test.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { describe, expect, test } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { regChinesePhoneNumber } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'../phone'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"describe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'phone'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'phone number belongs to Chinese'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"regChinesePhoneNumber"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'17725663831'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"输入命令"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm run test:unit"}]},{"type":"text","value":", 不出意外你会看到以下内容, 表明测试通过:\n"},{"type":"element","tag":"img","props":{"alt":"test result","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312071947299.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"编写测试的代码文件通常放置在"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"__test__"}]},{"type":"text","value":"文件夹中, 命名为"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"xxx.test.ts"}]},{"type":"text","value":"或"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"xxx.spec.ts"}]},{"type":"text","value":", Vitest 会自动运行所有此类命名的文件."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n编写测试的基础是"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"describe、test、expect"}]},{"type":"text","value":"关键字."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"describe"}]},{"type":"text","value":" 用于定义一个测试"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"套件"}]},{"type":"text","value":", 套件类似于 js 的模块, 用于将多个 test 封装到一起, 搭配"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"skip、only"}]},{"type":"text","value":"等 api 可以实现选择性测试等功能."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"test"}]},{"type":"text","value":" 用于声明一个测试, 接收测试名称和保存测试期望的函数."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"expect"}]},{"type":"text","value":" 用于设置断言, Vitest 默认提供基于"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"chai"}]},{"type":"text","value":"的断言, 你不知道什么是 chai 没关系, 断言是单元测试的关键助手, 后面会详细介绍"}]},{"type":"element","tag":"h1","props":{"id":"实践"},"children":[{"type":"text","value":"实践"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"接下来, 我们对几种常见的场景进行单测"}]},{"type":"element","tag":"h2","props":{"id":"hooks"},"children":[{"type":"text","value":"hooks"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"hooks 是逻辑的封装, 是最需要单测的场景."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n编辑器和表单有一个常见需求是记录上一次更改时间, 我们可以通过几行代码封装一个 hooks."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/hooks/useLastChange.ts */\nimport { watch, ref, type WatchSource } from 'vue'\nimport moment from 'moment/moment'\n\nexport function useLastChange(source: WatchSource) {\n  const lastChange = ref('')\n\n  watch(source, () => {\n    lastChange.value = moment().format('YYYY-MM-DD HH:mm:ss')\n  })\n\n  return lastChange\n}\n\n/** /src/hooks/__test__/useLastChange.test.ts */\nimport { expect, it } from 'vitest'\nimport { nextTick, ref } from 'vue'\nimport { useLastChange } from '../useLastChange'\n\nit('update lastChange when source changes', async () => {\n  const source = ref('')\n  const lastChange = useLastChange(source)\n  const snapShot01 = lastChange.value\n  source.value = 'Ray'\n  await nextTick()\n  const snapShot02 = lastChange.value\n\n  expect(snapShot01).not.toBe(snapShot02)\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/hooks/useLastChange.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { watch, ref, "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" WatchSource } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vue'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" moment "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'moment/moment'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"useLastChange"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"source"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"WatchSource"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"lastChange"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"ref"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"''"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"watch"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(source, () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    lastChange.value "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"moment"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"format"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'YYYY-MM-DD HH:mm:ss'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" lastChange\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/hooks/__test__/useLastChange.test.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { expect, it } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { nextTick, ref } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vue'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { useLastChange } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'../useLastChange'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'update lastChange when source changes'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"source"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"ref"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"''"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"lastChange"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"useLastChange"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(source)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"snapShot01"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" lastChange.value\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  source.value "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'Ray'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"nextTick"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"snapShot02"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" lastChange.value\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(snapShot01).not."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(snapShot02)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"hooks 的测试比较简单, 就是执行后比对结果. utils 和 reg 也是类似, 此处略过."}]},{"type":"element","tag":"h2","props":{"id":"scaffold"},"children":[{"type":"text","value":"scaffold"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"脚手架一般是框架自身提供的命令行工具, 用于生成模板代码, 放置于 bin 目录."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nVue 和 React 自身只提供了创建项目工具, 没有提供类似 Rails Command Line 的项目搭建工具. 因此前端spa项目的脚手架都是自己针对常见业务场景的封装."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n脚手架一般通过 npm 命令执行, 在 package.json 中添加一条命令"}]},{"type":"element","tag":"code","props":{"className":["language-json"],"code":"\"create\": \"node ./bin/create.js --type=$npm_config_type --path=$npm_config_path\n","language":"json","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"create\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"node ./bin/create.js --type=$npm_config_type --path=$npm_config_path"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"运行"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm run create --type=table --path='/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/views/TestTable.vue' "}]},{"type":"text","value":", 就会执行 /bin/index 脚本中的内容并将 type 和 path 值作为参数传递."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n编写 create 脚本:"}]},{"type":"element","tag":"code","props":{"className":["language-js"],"code":"/** /src/bin/create.js */\nimport minimist from 'minimist'\nimport { readFileSync, writeFileSync } from 'fs'\n\nfunction main() {\n  // 使用 minimist 处理参数\n  const args = minimist(process.argv.slice(2))\n  const { type, path } = args\n  let temp = ''\n  if(type === 'table') {\n    temp = readFileSync('./src/bin/dist/table', 'utf-8') \n  }\n  writeFileSync(path, temp)\n  console.log('\\n创建完成')\n}\n\nmain()\n","language":"js","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/bin/create.js */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" minimist "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'minimist'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { readFileSync, writeFileSync } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'fs'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 使用 minimist 处理参数\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"args"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"minimist"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(process.argv."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"slice"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"path"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" args\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" temp "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"''\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(type "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"==="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    temp "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"readFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'./src/bin/dist/table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'utf-8'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"writeFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(path, temp)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  console."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"创建完成'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"脚手架其实只进行 3 个操作, 获取参数, 读取对应的模板, 创建目标文件."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nvitest 和 jest 并没有比较好的执行 npm 命令的方法, 因此我们要对上面的方法稍加改造:"}]},{"type":"element","tag":"code","props":{"className":["language-js"],"code":"/** /src/bin/create.js */\nimport { readFileSync, writeFileSync } from 'fs'\n\nfunction create(args) {\n  const { type, path } = args\n  let temp = ''\n  if(type === 'table') {\n    temp = readFileSync('./src/bin/dist/table', 'utf-8') \n  } else {\n    throw '当前仅支持生成 table 类型'\n  }\n  writeFileSync(path, temp)\n  console.log('\\n创建完成')\n}\n\nexport default create\n\n/** /src/bin/index.js */\nimport create from './create'\n\n// 使用 minimist 处理参数\nconst args = minimist(process.argv.slice(2))\ntry {\n  create(args)\n} catch(e) {\n  console.log(e)\n}\n","language":"js","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/bin/create.js */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { readFileSync, writeFileSync } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'fs'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"args"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"path"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" args\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" temp "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"''\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(type "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"==="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    temp "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"readFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'./src/bin/dist/table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'utf-8'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"throw"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'当前仅支持生成 table 类型'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"writeFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(path, temp)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  console."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"创建完成'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" create\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/bin/index.js */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" create "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'./create'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 使用 minimist 处理参数\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"args"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"minimist"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(process.argv."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"slice"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(args)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"} "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(e) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  console."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(e)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"将脚本入口和执行方法分离是为了防止 unit test 过程中自动执行 main 方法报错."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n接下来我们就可以在 test 中导入 create 方法进行测试. 断言可以通过读取生成的模板内容和 table 文件中内容进行比较."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n以下是测试用例, 从参数、生成内容进行测试"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/bin/__test__/create.test.ts */\nimport create from '../create'\nimport { describe, expect, it } from 'vitest'\nimport { readFileSync } from 'fs'\n\ndescribe('bin scaffold module', () => {\n\n  describe('create table error args', () => {\n    it('error temp type', () => {\n      try {\n        create({\n          type: 'dialog',\n          path: '/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/dialog.vue'\n        })\n      } catch(e) {\n        expect(e).toBe('当前仅支持生成 table 类型')\n        const product = readFileSync('/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/dialog.vue', 'utf-8')\n        expect(product).toBeUndefined\n      }\n    })\n  })\n\n  it('create table', () => {\n    create({\n      type: 'table',\n      path: '/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/table.vue'\n    })\n    const temp = readFileSync('/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/dist/table', 'utf-8')\n    const product = readFileSync('/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/table.vue', 'utf-8')\n    expect(temp).toBe(product)\n  })\n\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/bin/__test__/create.test.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" create "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'../create'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { describe, expect, it } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { readFileSync } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'fs'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"describe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'bin scaffold module'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"describe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'create table error args'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'error temp type'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"          type: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'dialog'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"          path: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/dialog.vue'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(e) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(e)."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'当前仅支持生成 table 类型'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"product"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"readFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/dialog.vue'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'utf-8'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(product).toBeUndefined\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'create table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      type: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      path: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/table.vue'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"temp"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"readFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/dist/table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'utf-8'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"product"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"readFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/table.vue'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'utf-8'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(temp)."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(product)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"result","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312121120257.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"自定义-vue-指令"},"children":[{"type":"text","value":"自定义 Vue 指令"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"自定义一个 v-debounce, 用于给按钮增加防抖效果"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"import _ from 'lodash'\n\nconst vDebounce = {\n  beforeMount(el: HTMLElement, binding: {value: () => void}) {\n    el.addEventListener('click', _.debounce(binding.value, 600))\n  }\n}\n\napp.directive('debounce', vDebounce)\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" _ "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'lodash'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"vDebounce"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"beforeMount"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"el"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"HTMLElement"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"binding"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    el."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"addEventListener"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'click'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", _."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"debounce"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(binding.value, "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"600"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"app."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"directive"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'debounce'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", vDebounce)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"为了测试这个指令, 我们需要模拟"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"组件挂载->用户点击->方法调用的过程"}]},{"type":"text","value":", 也就是我们需要调用部分组件测试的能力. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"@vue/test-utils"}]},{"type":"text","value":" 是常用的 Vue 组件测试库."}]},{"type":"element","tag":"code","props":{"className":["language-bash"],"code":"pnpm install @vue/test-utils\n","language":"bash","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"pnpm"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"install"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"@vue/test-utils"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"vue-test-utils 兼容 jest 和 Vitest, 安装后可以直接使用. 下面是自定义指令的功能测试:"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/utils/__test__/directives.test.ts */\nimport { describe, expect, it } from 'vitest'\nimport { defineComponent, nextTick, ref } from 'vue'\nimport { mount } from '@vue/test-utils'\nimport { vDebounce } from '../directives'\n\n// 使用 defineComponent 定义测试组件\n// 该 api 除了 template 作为字符串传递外\n// 还可以使用 tsx 获得更好的代码提示\nconst tc = defineComponent({\n  setup() {\n    const num = ref(0)\n    function add() {\n      num.value++\n    }\n    return {\n      num,\n      add  \n    }\n  },\n  template: '<button v-debounce=\"add\">num: {{num}}</button>'\n})\n\ndescribe('custom directives', async () => {\n  // vue-test-utils 的 mount api, 将组件实例化\n  it('debounce submit', async () => {\n    const wrapper = mount(tc, {\n      global: {\n        directives: {\n          debounce: vDebounce\n        }\n      }\n    })\n\n    // 每过 200 毫秒点击一次 button\n    const interval = setInterval(async () => {\n      // find api 查找目标元素\n      await wrapper.find('button').trigger('click')\n    }, 200)\n    // 阻塞 1000 秒, 让点击事件在 1 秒内执行 4 次\n    await new Promise(resolve => setTimeout(resolve, 1000))\n\n    clearInterval(interval)\n\n    // 阻塞 700 秒, 等待函数执行\n    await new Promise(resolve => setTimeout(resolve, 700))\n    // 确保组件重新渲染\n    await nextTick()\n    // 获取目标元素\n    const btn = wrapper.get('button')\n    // 对目标元素的文本进行断言\n    expect(btn.text()).toBe('num: 1')\n  })\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/utils/__test__/directives.test.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { describe, expect, it } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { defineComponent, nextTick, ref } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vue'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { mount } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'@vue/test-utils'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { vDebounce } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'../directives'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 使用 defineComponent 定义测试组件\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 该 api 除了 template 作为字符串传递外\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 还可以使用 tsx 获得更好的代码提示\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"tc"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"defineComponent"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"setup"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"num"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"ref"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"add"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      num.value"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"++\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      num,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      add  \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  template: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'<button v-debounce=\"add\">num: {{num}}</button>'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"describe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'custom directives'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// vue-test-utils 的 mount api, 将组件实例化\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'debounce submit'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"wrapper"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"mount"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(tc, {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      global: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        directives: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"          debounce: vDebounce\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 每过 200 毫秒点击一次 button\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"interval"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"setInterval"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// find api 查找目标元素\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" wrapper."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"find"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'button'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"trigger"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'click'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }, "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"200"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 阻塞 1000 秒, 让点击事件在 1 秒内执行 4 次\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":41},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"setTimeout"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(resolve, "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"1000"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":42},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":43},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"clearInterval"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(interval)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":44},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":45},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 阻塞 700 秒, 等待函数执行\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":46},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"setTimeout"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(resolve, "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"700"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":47},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 确保组件重新渲染\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":48},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"nextTick"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":49},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 获取目标元素\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":50},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"btn"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" wrapper."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'button'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":51},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 对目标元素的文本进行断言\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":52},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(btn."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"text"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"())."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'num: 1'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":53},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":54},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"store"},"children":[{"type":"text","value":"store"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"大型的前端项目基本都会用到全局的状态管理库, Vue3 最流行的是 Pinia."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nPinia 提供了可用于测试的 api."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"import { createPinia, setActivePinia } from 'pinia'\nimport { beforeEach, describe, expect, it } from 'vitest'\nimport { useCounterStore } from '../counter'\n\ndescribe('Counter Store', () => {\n  beforeEach(() => {\n    setActivePinia(createPinia())\n  })\n\n  it('increments', () => {\n    const counter = useCounterStore()\n    expect(counter.count).toBe(0)\n    counter.increment()\n    expect(counter.count).toBe(1)\n  })\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { createPinia, setActivePinia } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'pinia'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { beforeEach, describe, expect, it } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { useCounterStore } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'../counter'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"describe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'Counter Store'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"beforeEach"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"setActivePinia"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"createPinia"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'increments'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"counter"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"useCounterStore"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(counter.count)."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    counter."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"increment"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(counter.count)."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这里引入了一个新的 api: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"beforeEach"}]},{"type":"text","value":", 这是一种"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"测试生命周期钩子"}]},{"type":"text","value":", 传入的方法在每个测试用例之前执行."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n我们传入了 pinia 的 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"setActivePinia"}]},{"type":"text","value":" api, 这是个 SSR 经常使用的 api, 用户设置一个激活的 Pinia 实例."}]},{"type":"element","tag":"h1","props":{"id":"断言"},"children":[{"type":"text","value":"断言"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"断言是单元测试的核心, 本质一堆用来判断结果的函数库."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n在上面的例子, 我们使用了"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"toBe"}]},{"type":"text","value":"断言, 这是最常用的断言, 该断言用于判断值相等或者相同引用, 类似于"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Object.is"}]},{"type":"text","value":"."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n以下为常用的几种断言:"}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"断言"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"功能"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"not"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"取反"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"判断值或对象引用是否相同"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toEqual"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"判断对象值是否相同"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBeGreaterThan"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"大于"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBeGreaterThanOrEqual"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"大于等于"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBeLessThan"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"小于"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBeLessThanOrEqual"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"小于等于"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"soft"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"expect.soft"}]},{"type":"text","value":" 遇到某条用例失败也不会停止测试, 直到所有用例执行完毕展示所有错误"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBeTypeOf"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"断言类型是否相同"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBeInstanceOf"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"判断是否是目标类的实例"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toStrictEqual"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"严格相等, 会检查具有 undefined 属性的 key、数组稀疏性、对象类型是否相等"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toContain"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"检查数组元素和子串"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toThrowError"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"检查函数调用过程中是否报错"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"resolves"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"expect(func()).resolves.toEqual"}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"rejects"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"expect(func()).rejects.toThrow"}]}]}]}]}]},{"type":"element","tag":"h1","props":{"id":"mock"},"children":[{"type":"text","value":"mock"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"为了应对业务耦合, 做到仅测试功能代码, 我们可以使用 mock 工具进行数据模拟."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n最常见的场景是模拟请求, 一般情况下你可以自己用一个 Promise 来模拟请求结果, 但有些情况也许你需要更真实的场景."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n常用的 mock 工具, 例如 APIfox, 是通过接口定义来「启动一个真实的服务器返回假数据」. 而 Vitest 并不会启动真正的 node 服务器, 而是通过"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"mswjs"}]},{"type":"text","value":"来拦截对应地址的请求."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n也就是说你可以很方便的去模拟「异常请求」的场景."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n首先安装 msw: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pnpm install msw"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"假设我们需要请求"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"https://thorn.mock/test"}]},{"type":"text","value":"这个接口, 获取"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"{msg: 'hey'}"}]},{"type":"text","value":"的 json 数据, 以下是我们的测试用例."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/api/__test__/mock.test.ts */\nimport { describe, expect, it } from 'vitest'\n\ndescribe('mock', async () => {\n  it('mock api', async () => {\n    const response = await fetch('https://thorn.mock/test') \n    // 使用 toEqual 来比较对象值\n    expect(await response.json()).toEqual({\n      msg: 'hey'\n    })\n  })\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/api/__test__/mock.test.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { describe, expect, it } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"describe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'mock'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'mock api'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"response"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"fetch"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'https://thorn.mock/test'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 使用 toEqual 来比较对象值\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" response."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"json"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"())."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toEqual"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      msg: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'hey'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"为了 mock 这个接口, 我们需要按照 msw 的语法编写一个 server."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/mocks/server.ts */\nimport { setupServer } from 'msw/node'\nimport { HttpHandler, HttpResponse, http } from 'msw'\n\nexport const handlers: Array<HttpHandler> = [\n  http.get('https://thorn.mock/test', () => {\n    return HttpResponse.json({\n      msg: 'hey'\n    })\n  })\n]\n\nexport const server = setupServer(...handlers)\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/mocks/server.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { setupServer } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'msw/node'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { HttpHandler, HttpResponse, http } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'msw'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"handlers"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Array"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"HttpHandler"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  http."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'https://thorn.mock/test'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" HttpResponse."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"json"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      msg: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'hey'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"setupServer"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"handlers)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"理想状况下, 我们希望每一次测试开始都启动 mock 服务器, 测试结束将服务关掉, Vitest 提供了四个 api 来实现这个过程."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n在 Vitest.config.ts 中, 添加 setupFiles 选项, 该选项接受"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"string|string[]"}]},{"type":"text","value":"作为文件路径, 写入的文件每次 Vitest 启动都会自动执行."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"defineConfig({\n  test: {\n    // ...\n    setupFiles: './src/setup.ts'\n    // ...\n  }\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"defineConfig"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  test: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    setupFiles: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'./src/setup.ts'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 setup.ts 文件中, 我们调用 Vitest 钩子:"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"import { server } from './mocks/server'\nimport { beforeAll, afterAll, afterEach } from 'vitest'\n\n// 在每一次测试开始前开启服务器\nbeforeAll(() => server.listen({ onUnhandledRequest: 'error' }))\n// 在每一次测试结束后关闭服务器\nafterAll(() => server.close())\n// 在每一个用例结束后重置 handlers\nafterEach(() => server.resetHandlers())\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { server } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'./mocks/server'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { beforeAll, afterAll, afterEach } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 在每一次测试开始前开启服务器\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"beforeAll"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" server."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({ onUnhandledRequest: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'error'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" }))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 在每一次测试结束后关闭服务器\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"afterAll"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" server."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"close"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 在每一个用例结束后重置 handlers\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"afterEach"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" server."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"resetHandlers"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"())"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"开启测试, 会显示测试已通过."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"img","props":{"alt":"unit test pass","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312141529162.png"},"children":[]},{"type":"text","value":"\n请注意, 因为 msw 的作用是拦截请求而不是开启模拟服务器, 因此直接本地调用并不起作用."}]},{"type":"element","tag":"h1","props":{"id":"异步测试"},"children":[{"type":"text","value":"异步测试"}]},{"type":"element","tag":"h1","props":{"id":"优化测试过程"},"children":[{"type":"text","value":"优化测试过程"}]},{"type":"element","tag":"h2","props":{"id":"内联测试"},"children":[{"type":"text","value":"内联测试"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"就和内联样式表一样, 所谓内联测试就是将测试代码和源码写在一起."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n改造一下正则表达式的例子:"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/reg/phone.ts */\nexport function regChinesePhoneNumber(phoneNumber: string) {\n  const regex = /^1[3456789]\\d{9}$/\n  return regex.test(phoneNumber)\n}\n\n// 内联测试应该放在源码的底部\n/**\n * 为了解决 ts 报错\n * 需要在 tsconfig.json 中添加\n * {\"compilerOptions\": {\"types\": [\"vitest/importMeta\"]}}\n */\nif(import.meta.vitest) {\n  const { it, expect } = import.meta.vitest\n  it('phone number belongs to Chinese', () => {\n    expect(regChinesePhoneNumber('41772566381')).toBe(false)\n  })\n}\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/reg/phone.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"regChinesePhoneNumber"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"phoneNumber"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"regex"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-273446"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"^"}]},{"type":"element","tag":"span","props":{"class":"ct-273446"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"[3456789]\\d"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"{9}$"}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"/\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" regex."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(phoneNumber)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 内联测试应该放在源码的底部\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/**\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":" * 为了解决 ts 报错\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":" * 需要在 tsconfig.json 中添加\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":" * {\"compilerOptions\": {\"types\": [\"vitest/importMeta\"]}}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":" */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"meta"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":".vitest) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"meta"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":".vitest\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'phone number belongs to Chinese'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"regChinesePhoneNumber"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'41772566381'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"随后更新一下"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"vitest.config.ts"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"export default defineConfig({\n  test: {\n    includeSource: ['src/**/*.{js,ts}'], \n  }\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"defineConfig"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  test: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    includeSource: ["}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'src/**/*.{js,ts}'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"], \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可以看到新运行的用例增加了一个非"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"test.ts"}]},{"type":"text","value":"结尾的文件."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"img","props":{"alt":"in source test","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312141609782.png"},"children":[]},{"type":"text","value":"\n这样做的缺点是会造成打包后的代码体积膨胀, 但我们可以做一些处理让代码块作为不会被执行的区块被 tree-shake 掉."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** vite.config.ts */\nexport default defineConfig({\n  define: {\n    'import.meta.vitest': 'undefined', \n  }, \n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** vite.config.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"defineConfig"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  define: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'import.meta.vitest'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'undefined'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }, \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"类型测试-experimental"},"children":[{"type":"text","value":"类型测试 (Experimental)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ts 的类型在编译后会被擦除, 也就是说无论类型代码写的有多完备, 对真正运行的 js 代码并不会有影响. 但通过类型测试可以促使类型代码更sound, 以此提高 ts 项目的强健性."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n不过总的来说类型测试并不常用, 此处仅介绍一下一般流程."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/types/MPick.d.ts */\n// 实现一个自己的 Pick 方法\nexport type MPick<T, K extends keyof T> = {\n  [P in K]: T[P]\n}\n\n/** /src/types/__test__/MPick.test-d.ts */\n\n// vitest 会自动扫描 .test-d.ts 命令的文件\nimport { expectTypeOf, test } from 'vitest'\nimport type { MPick } from '../MPick'\n\ntest('test mock Pick', () => {\n  interface Foo {\n    a: string\n    b: number\n  }\n  type Bar = MPick<Foo, 'a'>\n  interface Exp {\n    a: string\n  }\n  expectTypeOf<Bar>().toEqualTypeOf<Exp>()\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/types/MPick.d.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 实现一个自己的 Pick 方法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"MPick"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"T"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"K"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"extends"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"keyof"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"T"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  ["}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"P"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"K"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"]"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"T"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"["}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"P"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/types/__test__/MPick.test-d.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// vitest 会自动扫描 .test-d.ts 命令的文件\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { expectTypeOf, test } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { MPick } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'../MPick'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'test mock Pick'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"interface"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Foo"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"string\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"b"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"number\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Bar"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"MPick"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Foo"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'a'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"interface"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Exp"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"string\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expectTypeOf"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Bar"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">()."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toEqualTypeOf"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Exp"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"为了启动类型测试, 需要在启动时指定 --typecheck, 添加一个新的 npm 命令 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"\"test:type\": \"vitest --typecheck\""}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n运行"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pnpm run test:type"}]},{"type":"text","value":"运行测试"}]},{"type":"element","tag":"h2","props":{"id":"可视化"},"children":[{"type":"text","value":"可视化"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vitest 提供了 UI 界面进行交互, 运行"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pnpm install @vitest/ui"}]},{"type":"text","value":"安装, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pnpm run test:unit --ui"}]},{"type":"text","value":" 启动\n"},{"type":"element","tag":"img","props":{"alt":"ui","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312141744611.png"},"children":[]},{"type":"text","value":"\n里面涵盖了几乎所有的操作, 还可以查看 console、源码和依赖图.\n"},{"type":"element","tag":"img","props":{"alt":"Graph","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312141745142.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"代码覆盖率"},"children":[{"type":"text","value":"代码覆盖率"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vitest 通过 V8 提供代码覆盖率检查, 运行"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pnpm install @vitest/coverage-v8"}]},{"type":"text","value":"安装"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n在 vitest.config 中配置覆盖率选项"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"defineConfig({\n  test: {\n    coverage: {\n      enabled: true,\n      reporter: ['html']\n    }\n  }\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"defineConfig"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  test: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    coverage: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      enabled: "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      reporter: ["}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'html'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这样就可以在 ui 界面上看到代码覆盖率结果了"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"img","props":{"alt":"coverage ui","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312141752020.png"},"children":[]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-941699{color:#B392F0;}\n.light .ct-941699{color:#6F42C1;}\n.ct-212337{color:#E1E4E8;}\n.light .ct-212337{color:#24292E;}\n.ct-695486{color:#9ECBFF;}\n.light .ct-695486{color:#032F62;}\n.ct-055721{color:#79B8FF;}\n.light .ct-055721{color:#005CC5;}\n.ct-338738{color:#FDAEB7;font-style:italic;}\n.light .ct-338738{color:#B31D28;font-style:italic;}\n.ct-782603{color:#6A737D;}\n.ct-984823{color:#F97583;}\n.light .ct-984823{color:#D73A49;}\n.ct-880416{color:#FFAB70;}\n.light .ct-880416{color:#E36209;}\n.ct-273446{color:#DBEDFF;}\n.light .ct-273446{color:#032F62;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"hooks","depth":2,"text":"hooks"},{"id":"scaffold","depth":2,"text":"scaffold"},{"id":"自定义-vue-指令","depth":2,"text":"自定义 Vue 指令"},{"id":"store","depth":2,"text":"store"},{"id":"内联测试","depth":2,"text":"内联测试"},{"id":"类型测试-experimental","depth":2,"text":"类型测试 (Experimental)"},{"id":"可视化","depth":2,"text":"可视化"},{"id":"代码覆盖率","depth":2,"text":"代码覆盖率"}]}},"_type":"markdown","_id":"content:1701870426245.md","_source":"content","_file":"1701870426245.md","_extension":"md"}