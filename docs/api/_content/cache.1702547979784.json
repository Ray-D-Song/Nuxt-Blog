{"generatedAt":1702547988492,"generateTime":2553,"contents":[{"_path":"/1692667782462","_dir":"","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"协程(Coroutine)和纤程(Fiber)","description":"最近在看 C++ 引入 Fiber 的[N4024文档: 区分纤程和协程](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4024.pdf), 文章给纤程和协程十分明确的区分. 但过去我看过的很多资料会将其混为一谈或者模糊二者的边界, 所以写了这篇博客来总结一下.","cover":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202308221107239.png","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最近在看 C++ 引入 Fiber 的"},{"type":"element","tag":"a","props":{"href":"https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4024.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"N4024文档: 区分纤程和协程"}]},{"type":"text","value":", 文章给纤程和协程十分明确的区分. 但过去我看过的很多资料会将其混为一谈或者模糊二者的边界, 所以写了这篇博客来总结一下."}]},{"type":"element","tag":"h1","props":{"id":"纤程"},"children":[{"type":"text","value":"纤程"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"线程是一种轻量级的线程, 本质是对线程时间进行切片处理, 调度也由用户进行. 最早是 Microsoft 为了解决 Unix 平台的引用程序移植到 Windows 上时出现的问题而发起的提案.\n因此, 纤程是一种偏底层的概念, 通常由操作系统或runtime自动管理, 并不需要程序员手动干预. 例如 Windows 上的纤程就是在其内核上实现."}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"值得注意的是, php8 引入的 Fiber 虽然叫做纤程, 其本质是协程."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一个线程可以包含多个纤程, 纤程的好处是可以有效防止长时间的线程挂起. 例如在 IO 操作时, 实例化一个纤程进行 IO 操作, 在该纤程阻塞的过程中, 因为仅占用了一部分的时间切片, 程序依旧可以继续执行."}]},{"type":"element","tag":"h1","props":{"id":"协程"},"children":[{"type":"text","value":"协程"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"协程的核心就是协作, 通过明确的挂起和恢复来控制执行的流程，使得不同任务之间可以更好地协同工作，共享信息，避免竞态条件，提高性能.\n协程在许多语言中都有实现, 例如 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Lua、Go、Ruby、Java(Virtual Threads)"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Python 和 JavaScript(基于生成器)"}]},{"type":"text","value":".\n如果要用一句话来总结协程: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"控制流的主动让出和恢复"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"有栈协程和无栈协程"},"children":[{"type":"text","value":"有栈协程和无栈协程"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"协程有很多种, 按照多个协程之间是否存在调用栈, 可以分为"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"有栈协程(如goroutine、lua协程)"}]},{"type":"text","value":"和"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"无栈协程(如JavaScript、Dart、Python)"}]},{"type":"text","value":"."}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"调用栈的作用是保存协程挂起时的状态.\n有栈协程在恢复时会将其上下文从栈内存中捞出恢复到系统栈中.\n无栈协程的挂起和恢复则依赖闭包和状态机实现."}]}]},{"type":"element","tag":"h2","props":{"id":"对称协程和非对称协程"},"children":[{"type":"text","value":"对称协程和非对称协程"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"非对称协程提供"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"两种控制操作"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"调用协程"}]},{"type":"text","value":"和"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"挂起协程"}]},{"type":"text","value":". 非对称协程可以看做是其调用者的从属, 跟特定调用者绑定, 在让出控制权时, 只能回到原调用者.\n对称协程提供"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"单个控制操作"}]},{"type":"text","value":", 可以通过该操作在协程之间显示的传递控制权. 对称协程在启动后和原调用者就没什么关系了, 也因此, 对称协程需要一个调度器去选择转移控制权操作的目标协程."}]},{"type":"element","tag":"h3","props":{"id":"对称"},"children":[{"type":"text","value":"对称"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"对称协程的例子非常少, 以下是 C++ "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Boost.Coroutine"}]},{"type":"text","value":" 的示例."}]},{"type":"element","tag":"code","props":{"className":["language-cpp"],"code":"#include <iostream>\n#include <coroutine>\n\nstruct CountingCoroutine {\n    struct promise_type {\n        int current_value = 0;\n\n        CountingCoroutine get_return_object() {\n            return CountingCoroutine(std::coroutine_handle<promise_type>::from_promise(*this));\n        }\n\n        std::suspend_always initial_suspend() { return {}; }\n        std::suspend_always final_suspend() noexcept { return {}; }\n        void return_void() {}\n        void unhandled_exception() {}\n        std::suspend_always yield_value(int value) {\n            current_value = value;\n            return {};\n        }\n    };\n\n    std::coroutine_handle<promise_type> coroutine;\n\n    CountingCoroutine(std::coroutine_handle<promise_type> handle) : coroutine(handle) {}\n\n    ~CountingCoroutine() {\n        if (coroutine)\n            coroutine.destroy();\n    }\n\n    int getValue() const {\n        return coroutine.promise().current_value;\n    }\n\n    void resume() {\n        coroutine.resume();\n    }\n};\n\nCountingCoroutine generateNumbers() {\n    for (int i = 0; i < 10; ++i) {\n        //移交控制权\n        co_yield i;\n    }\n}\n\nint main() {\n    CountingCoroutine counter = generateNumbers();\n\n    while (counter.coroutine) {\n        std::cout << \"Value: \" << counter.getValue() << std::endl;\n        //回到 co_yield 继续执行\n        counter.resume();\n    }\n\n    return 0;\n}\n","language":"cpp","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"#include"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"<iostream>\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"#include"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"<coroutine>\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"struct"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"CountingCoroutine"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"struct"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"promise_type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" current_value "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"CountingCoroutine"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"get_return_object"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"CountingCoroutine"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"std"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"coroutine_handle"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"promise_type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">::"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"from_promise"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"));\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"std"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"suspend_always"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"initial_suspend"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() { "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {}; }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"std"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"suspend_always"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"final_suspend"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"noexcept"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {}; }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"return_void"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"unhandled_exception"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"std"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"suspend_always"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"yield_value"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            current_value "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" value;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    };\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"std"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"::coroutine_handle"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"promise_type"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" coroutine;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"CountingCoroutine"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"std"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"coroutine_handle"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"promise_type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"handle"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") : "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"coroutine"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(handle) {}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"~CountingCoroutine"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" (coroutine)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            coroutine."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"destroy"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"getValue"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" coroutine."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"promise"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"().current_value;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"resume"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        coroutine."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"resume"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"CountingCoroutine"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"generateNumbers"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":41},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"; i "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"10"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"++"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"i) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":42},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"        //移交控制权\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":43},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"co_yield"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" i;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":44},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":45},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":46},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":47},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":48},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    CountingCoroutine counter "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"generateNumbers"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":49},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":50},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"while"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" (counter.coroutine) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":51},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"std"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"::cout "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"Value: \""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" counter."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"getValue"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"std"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"::endl;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":52},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"        //回到 co_yield 继续执行\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":53},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        counter."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"resume"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":54},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":55},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":56},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":57},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 Go 语言中, 我们可以通过 chan 在没有特定从属关系的情况下完成协程间控制权的转移, 也算是对称协程的实现:"}]},{"type":"element","tag":"code","props":{"className":["language-go"],"code":"func main() {\n    ch1 := make(chan int)\n    ch2 := make(chan int)\n\n    var wg sync.WaitGroup\n\n    wg.Add(1)\n    go func() { // <--- 1\n        defer wg.Done()\n        for val := range ch1 {\n            fmt.Println(val)\n        }\n    }()\n\n    wg.Add(1)\n    go func() { // <--- 2\n        defer wg.Done()\n        for val := range ch2 {\n            ch1 <- val\n        }\n        close(ch1)\n    }()\n\n    wg.Add(1)\n    go func() { // <--- 3\n        defer wg.Done()\n        for i := 1; i <= 5; i++ {\n            ch2 <- i\n        }\n        close(ch2)\n    }()\n\n    wg.Wait()\n}\n","language":"go","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"func"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    ch1 "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"chan"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    ch2 "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"chan"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" wg sync.WaitGroup\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    wg."}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"Add"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"go"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"func"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() { "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// <--- 1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"defer"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" wg."}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"Done"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" val "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" ch1 {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            fmt."}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"Println"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(val)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    wg."}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"Add"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"go"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"func"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() { "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// <--- 2\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"defer"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" wg."}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"Done"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" val "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" ch2 {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            ch1 "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"<-"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" val\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"close"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(ch1)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    wg."}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"Add"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"go"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"func"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() { "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// <--- 3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"defer"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" wg."}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"Done"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"; i "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"<="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"; i"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"++"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            ch2 "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"<-"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" i\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"close"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(ch2)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    wg."}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"Wait"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果按照代码的顺序执行, 那正确的排列顺序是 3 2 1, 但在此处由于channel的阻塞特性, 第一个goroutine会等待第二个goroutine将数据从 ch2 传输到 ch1, 而第二个goroutine会等待第三个goroutine将数据发送到 ch2, 这就保证了它们的执行顺序. 最后，当所有goroutine都完成并且WaitGroup计数为0时, wg.Wait() 返回, 程序退出."}]},{"type":"element","tag":"h3","props":{"id":"非对称"},"children":[{"type":"text","value":"非对称"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"JavaScript 的 async、await、promise 则是创建非对称协程的工具."}]},{"type":"element","tag":"code","props":{"className":["language-javascript"],"code":"// async 标记的函数会创建协程\nconst useFetch = async () => { \n  // 执行到 await 处会将该协程挂起, 直到 fetch 返回\n  const res = await fetch('https://www.v2ex.com/api/topics/hot.json')\n  return res.json()\n}\n\nconst main = () => {\n  console.log('main start')\n  // 执行到此处, 控制权转移到协程\n  useFetch().then(res => { \n    // 执行到函数内部 await 处, 暂时挂起, 控制权返回到 main\n    console.log(`fetch res: ${res}`)\n  })\n  console.log('main end')\n}\n\nmain()\n/**\n * main start\n * main end\n * fetch res: ...\n */\n","language":"javascript","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// async 标记的函数会创建协程\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"useFetch"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 执行到 await 处会将该协程挂起, 直到 fetch 返回\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"res"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"fetch"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'https://www.v2ex.com/api/topics/hot.json'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" res."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"json"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  console."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'main start'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 执行到此处, 控制权转移到协程\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"useFetch"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"res"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 执行到函数内部 await 处, 暂时挂起, 控制权返回到 main\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    console."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"`fetch res: ${"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"res"}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"}`"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  console."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'main end'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/**\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":" * main start\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":" * main end\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":" * fetch res: ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":" */"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可以看到, 在 JS 中, 协程转移的控制权一定会返回到协程的调用者上."}]},{"type":"element","tag":"h1","props":{"id":"异同"},"children":[{"type":"text","value":"异同"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"看到这里, 会发现纤程和协程极为相似.\n没错, 大框架上两者的基本概念是一样的. 仅有的区别是纤程的状态保存由操作系统API提供, 而协程保存和恢复的方式由语言或库提供, 背后的实现更是则多种多样.\n所以我们可以认为: 纤程实际上就是由操作系统提供的协程.\n参考"},{"type":"element","tag":"a","props":{"href":"https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4024.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"Distinguishing coroutines and fibers"}]},{"type":"text","value":", 以下是一些细节的差别:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Fiber 在发起后不再依赖于发起它的程序存在, 可以拥有独立的生命周期.\nCoroutine 作为发起者的「子程序」, 不存在独立的生命周期."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Fiber 和 Thread 行为模式基本一致. 存在一个调度器, 某个 Fiber 被阻塞, 会将控制权移交至调度器, 由调度器去唤起其他准备运行的 Fiber.\n对称协程的行为方式和 Fiber 基本一致. 非对称协程不存在调度器, 控制权会回到发起者."}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-984823{color:#F97583;}\n.light .ct-984823{color:#D73A49;}\n.ct-212337{color:#E1E4E8;}\n.light .ct-212337{color:#24292E;}\n.ct-695486{color:#9ECBFF;}\n.light .ct-695486{color:#032F62;}\n.ct-941699{color:#B392F0;}\n.light .ct-941699{color:#6F42C1;}\n.ct-055721{color:#79B8FF;}\n.light .ct-055721{color:#005CC5;}\n.ct-880416{color:#FFAB70;}\n.light .ct-880416{color:#E36209;}\n.ct-782603{color:#6A737D;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"有栈协程和无栈协程","depth":2,"text":"有栈协程和无栈协程"},{"id":"对称协程和非对称协程","depth":2,"text":"对称协程和非对称协程","children":[{"id":"对称","depth":3,"text":"对称"},{"id":"非对称","depth":3,"text":"非对称"}]}]}},"_type":"markdown","_id":"content:1692667782462.md","_source":"content","_file":"1692667782462.md","_extension":"md"},{"_path":"/1693682341339","_dir":"","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"tailwind css的价值","description":"tailwind 一直饱受非议, 其中说的最多的大概就是「我为什么不直接写内联样式?」. 其实 tailwind 不仅是简写了样式名这么简单, 它是一系列便利的封装.","cover":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202309030328341.png","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"tailwind 一直饱受非议, 其中说的最多的大概就是「我为什么不直接写内联样式?」.\n其实 tailwind 不仅是简写了样式名这么简单, 它是一系列便利的封装."}]},{"type":"element","tag":"h1","props":{"id":"动画"},"children":[{"type":"text","value":"动画"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"举个简单的例子, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"animate-spin"}]},{"type":"text","value":" 属性用于添加旋转动画, 常用在 loading 中. 如果你用传统的 css/sass 编写, 那你至少需要以下代码."}]},{"type":"element","tag":"code","props":{"className":["language-css"],"code":"animation: spin 1s linear infinite;\n\n@keyframes spin {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n","language":"css","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"animation: spin 1s linear infinite;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"@keyframes"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"spin"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"transform"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"rotate"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"deg"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"to"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"transform"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"rotate"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"360"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"deg"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h1","props":{"id":"交互"},"children":[{"type":"text","value":"交互"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果你希望一个 button 在鼠标炫富时颜色变浅, 在 tailwind 中只需要简单的"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hover:opacity-90"}]},{"type":"text","value":", 传统的 css 则需要:"}]},{"type":"element","tag":"code","props":{"className":["language-css"],"code":".btn:hover {\n  background-color: rga(xxx,xxx,xxx, 0.9)\n}\n","language":"css","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":".btn:hover"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"background-color"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":": rga(xxx,xxx,xxx, "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"0.9"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h1","props":{"id":"响应式设计"},"children":[{"type":"text","value":"响应式设计"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"同时现代很多网页需要同时满足大屏设备和移动小屏设备的适配, 一般我们会用 css3 的 @media 来根据窗口尺寸编写不同的 css."}]},{"type":"element","tag":"code","props":{"className":["language-css"],"code":"@media (max-width: 768px) {\n  body {\n    width: 80%\n  }\n}\n","language":"css","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"@media"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"max-width"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"768"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"px"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"body"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"width"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"80"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"%\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 tailwind 上, 适配 768px 宽度的设备, 你只要在样式前加入 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"md"}]},{"type":"text","value":" 前缀即可."}]},{"type":"element","tag":"code","props":{"className":["language-html"],"code":"<body class=\"md:w-4/5\">\n","language":"html","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"body"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"md:w-4/5\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">"}]}]}]}]}]},{"type":"element","tag":"h1","props":{"id":"利好无设计开发"},"children":[{"type":"text","value":"利好无设计开发"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"个人或者小团队开发产品, 没有专业的设计师出图, 写组件相当痛苦.\n例如 box-shadow 属性, button、card、modal, 每个都需要不一样的 shadow 样式. 在自己编写的时候经常要重复修改多次来达到一个比较好的效果, twc 提供了 7 个不同规格的选项, 都是泛用性非常高的选择.\n现在你要写一个现代化外观的按钮只需要"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"class=\"shadow-md rounded-lg\""}]},{"type":"text","value":"就行了."}]},{"type":"element","tag":"h1","props":{"id":"新的组件模式"},"children":[{"type":"text","value":"新的组件模式"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"tailwind 还有个衍生品, Headless UI. 将组件的功能和样式彻底分离. 很多时候组件的功能是相同的 , 但是需要不同的样式, 有时候样子一样的组件却需要完全不同的 api. Headless 就是为了解决这个问题."}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NuxtLab UI 就是一个无头tailwind组件库, 闲得蛋疼可以看看, 代码很干净."}]}]},{"type":"element","tag":"h1","props":{"id":"class-也太特么长了"},"children":[{"type":"text","value":"class 也太特么长了"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这是一个由 tailwind 编写的 checkbox, 做了动效和深色适配."}]},{"type":"element","tag":"code","props":{"className":["language-html"],"code":"<input type=\"checkbox\" class=\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600\"/>\n","language":"html","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"input"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"checkbox\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"/>"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"看到这个长度是不是蚌埠住了. 没关系 tailwind 有"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"@layer"}]},{"type":"text","value":"和"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"@apply"}]},{"type":"text","value":", 你可以像组织传统 css 一样去组织 tailwind, 封装自己的样式组件."}]},{"type":"element","tag":"code","props":{"className":["language-css"],"code":"@layer components {\n  .checkbox {\n    @apply\n    w-4\n    h-4\n    text-blue-600\n    bg-gray-100\n    border-gray-300\n    rounded\n    focus:ring-blue-500\n    dark:focus:ring-blue-600\n    dark:ring-offset-gray-800\n    focus:ring-2\n    dark:bg-gray-700\n    dark:border-gray-600\n  }\n}\n","language":"css","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"@layer"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" components {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":".checkbox"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    @"}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"apply\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"w-"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"4\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"h-"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"4\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"text-blue-"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"600\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"bg-gray-"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"100\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"border-gray-"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"300\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"rounded\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"focus"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":":ring-blue-500\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"dark"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":":focus:ring-blue-600\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"dark"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":":ring-offset-gray-800\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    focus:ring-2\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"dark"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":":bg-gray-700\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"dark"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":":border-gray-600\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"过长的样式导致的问题是无法避免的, 即便你直接写内联也是一样, 最终一定会回到封装样式组件的路上. 但之前所有的好处(抽象、减少代码量、响应式...)都还在.\n这也是一种「不过早抽象」的价值. 一个小的 idea, 你可以一把梭抢先实现原型, 后期再抽离维护, tailwind 降低了这一操作的难度."}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"当然, 这种种好处的前提是, 要么你写风格多样化的 C 端界面, 要么需要创建属于自己团队的组件库. 然而很明显, 大多数公司还停留在"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"element antd"}]},{"type":"text","value":"一把梭的阶段. 但这当然不是 tailwind 的问题."}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"实际上海外 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"3T架构(Next tRPC Tailwind)"}]},{"type":"text","value":" 已经火了有一阵了, 当然你也可以说这是前端瞎折腾, 但这确实是写出「现代、好看、交互强的界面」的捷径."}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-212337{color:#E1E4E8;}\n.light .ct-212337{color:#24292E;}\n.ct-984823{color:#F97583;}\n.light .ct-984823{color:#D73A49;}\n.ct-880416{color:#FFAB70;}\n.light .ct-880416{color:#E36209;}\n.ct-941699{color:#B392F0;}\n.light .ct-941699{color:#6F42C1;}\n.ct-055721{color:#79B8FF;}\n.light .ct-055721{color:#005CC5;}\n.ct-735963{color:#85E89D;}\n.light .ct-735963{color:#22863A;}\n.ct-695486{color:#9ECBFF;}\n.light .ct-695486{color:#032F62;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:1693682341339.md","_source":"content","_file":"1693682341339.md","_extension":"md"},{"_path":"/1694241377468","_dir":"","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"试试 WebComponents","description":"最近突然觉得`All in Frontend Framework`非常的麻烦, 引入和编写了很多代码就为了解决一些简单的问题. 所以在寻找无痛嵌入 Rails/Larval/Django 等 mvc 框架的前端解决方案.","cover":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202309091438630.png","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最近突然觉得"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"All in Frontend Framework"}]},{"type":"text","value":"非常的麻烦, 引入和编写了很多代码就为了解决一些简单的问题. 所以在寻找无痛嵌入 Rails/Larval/Django 等 mvc 框架的前端解决方案."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"首先前端框架最大的意义是引入组件机制, 带来了逻辑的抽象和可复用性. 在这方面, 现代浏览器提供了一个原生的解决方案, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Web Components"}]},{"type":"text","value":" (以下简称"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"wcp"}]},{"type":"text","value":")."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"wcp 是基于 JavaScript class 的封装, 先看一个简单的 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Card"}]},{"type":"text","value":" 组件示例, 然后再解释一些关键的概念."}]},{"type":"element","tag":"code","props":{"className":["language-html"],"code":"<body>\n  <template id=\"custom-card-template\">\n    <style>\n      /* 省略样式 */\n    </style>\n    <div class=\"container\">\n      <img class=\"cover\" src=\"https://lit.dev/images/logo.svg\">\n      <div class=\"desc\">Web Components FrameWork</div>\n    </div>\n  </template>\n\n  <div>自定义卡片组件: </div>\n  <custom-card></custom-card>\n</body>\n\n<script>\n  customElements.define('custom-card', ( // wcp 的定义方法\n    class card extends HTMLElement{\n      constructor() {\n        super() // super 方法必须放在顶部\n\n        const root = this.attachShadow({mode: 'open'}) // 创建 shadowDOM 的根元素\n        const template = document.getElementById('custom-card-template').content // 获取模板内容\n        root.appendChild(template.cloneNode(true)) // 挂载模板\n      }\n    }\n  ))\n</script>\n","language":"html","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"body"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  <"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"id"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"custom-card-template\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    <"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"style"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/* 省略样式 */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    </"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"style"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    <"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"container\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      <"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"cover\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"src"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"https://lit.dev/images/logo.svg\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      <"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"desc\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">Web Components FrameWork</"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    </"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  </"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  <"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">自定义卡片组件: </"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  <"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"custom-card"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"></"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"custom-card"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"body"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  customElements."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"define"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'custom-card'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", ( "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// wcp 的定义方法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"card"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"extends"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"HTMLElement"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"constructor"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"super"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// super 方法必须放在顶部\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"attachShadow"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({mode: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'open'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}) "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 创建 shadowDOM 的根元素\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" document."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"getElementById"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'custom-card-template'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":").content "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 获取模板内容\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        root."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"appendChild"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(template."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"cloneNode"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")) "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 挂载模板\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  ))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"showcase:\n"},{"type":"element","tag":"img","props":{"alt":"showcase","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202309062231860.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"customelementsdefine"},"children":[{"type":"text","value":"customElements.define"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"定义web components 的方法, 接收三个参数, 组件名、定义组件的类、继承自哪个原生元素(可选)\n上面的例子是自定了一个全新的元素, 你也可以选择基于"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"span"}]},{"type":"text","value":"标签去定义一个鼠标放置就会出现提示文案的"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"tooltip-span"}]}]},{"type":"element","tag":"code","props":{"className":["language-js"],"code":"window.customElements.define('tool-tip',\n  class toolTip extends HTMLSpanElement { // 继承 span 元素\n    constructor() {\n      super()\n      const spans = document.querySelectorAll('span')\n      spans.forEach((item) => {\n        if(item.getAttribute('is')==='tool-tip'){\n          item.style.position = 'relative'\n          // 注册光标放置事件, 放置后添加tip子元素\n          item.addEventListener('mouseenter', () => {\n            const tip = document.createElement('span')\n            tip.textContent = \"When you hover your mouse over it, a more detailed description will appear.\"\n            // 样式\n            tip.style.position = 'absolute'\n            tip.style.top = '100%'\n            tip.style.left = '0'\n            tip.style.backgroundColor = '#111827'\n            tip.style.color = '#98ABB9'\n            tip.id = 'tip'\n            item.appendChild(tip)\n          })\n          // 光标离开后移除子元素\n          item.addEventListener('mouseout', () => {\n            const tips = document.querySelectorAll('#tip')\n            tips.forEach(item => item.remove())\n          })\n        }\n      })\n    }\n  }, {\n  extends: 'span'\n})\n","language":"js","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"window.customElements."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"define"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'tool-tip'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toolTip"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"extends"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"HTMLSpanElement"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 继承 span 元素\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"constructor"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"super"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"spans"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" document."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"querySelectorAll"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'span'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      spans."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"forEach"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(item."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"getAttribute"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'is'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"==="}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'tool-tip'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"){\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"          item.style.position "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'relative'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"          "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 注册光标放置事件, 放置后添加tip子元素\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"          item."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"addEventListener"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'mouseenter'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"tip"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" document."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"createElement"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'span'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            tip.textContent "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"When you hover your mouse over it, a more detailed description will appear.\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 样式\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            tip.style.position "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'absolute'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            tip.style.top "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'100%'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            tip.style.left "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'0'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            tip.style.backgroundColor "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'#111827'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            tip.style.color "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'#98ABB9'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            tip.id "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'tip'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            item."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"appendChild"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(tip)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"          })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"          "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 光标离开后移除子元素\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"          item."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"addEventListener"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'mouseout'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"tips"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" document."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"querySelectorAll"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'#tip'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"            tips."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"forEach"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" item."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"remove"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"          })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }, {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  extends: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'span'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"code","props":{"className":["language-html"],"code":"<script src=\"./card.js\" async></script>\n\n<div>\n  <!-- is 属性注明这是自定义的 tool-tip 元素 -->\n  <span is=\"tool-tip\">tool-tip</span>\n</div>\n","language":"html","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"src"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"./card.js\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"></"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"<!-- is 属性注明这是自定义的 tool-tip 元素 -->\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  <"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"span"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"is"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"tool-tip\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">tool-tip</"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"span"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"showcase:\n"},{"type":"element","tag":"img","props":{"alt":"showcase","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202309091434319.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"template"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vue 开发者对此一定不陌生, 浏览器原生的 template 标签和内容物在加载页面时不会出现, 多数情况下仅做容器作用, 在 wpc 中可以理解为"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"(可复用的)一组标签的容器"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"slot"},"children":[{"type":"text","value":"slot"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"slot(插槽的作用)就和其名字一样, 在模板中定义"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"<slot>"}]},{"type":"text","value":"标签, 给他取个好听的名字, 页面上给 wcp 传入子元素就会被嵌入在定义插槽的位置.\n一个简单的示例:"}]},{"type":"element","tag":"code","props":{"className":["language-js"],"code":"const cardInner = `\n  <div>\n    <slot name=\"description\" style=\"font-style: italic; font-size: large;\">default description</slot>\n  </div>\n`\n","language":"js","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"cardInner"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"`\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"  <div>\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"    <slot name=\"description\" style=\"font-style: italic; font-size: large;\">default description</slot>\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"  </div>\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"`"}]}]}]}]}]},{"type":"element","tag":"code","props":{"className":["language-html"],"code":"<custom-card>\n  <!-- slot 属性等于插槽名 -->\n  <span slot=\"description\">Ray-D-Song</span>\n</custom-card>\n<!-- 页面上会出现斜体的 Ray-D-Song -->\n","language":"html","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"custom-card"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"<!-- slot 属性等于插槽名 -->\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  <"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"span"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"slot"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"description\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">Ray-D-Song</"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"span"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"custom-card"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"<!-- 页面上会出现斜体的 Ray-D-Song -->"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"shadow-dom"},"children":[{"type":"text","value":"shadow DOM"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果你打开浏览器控制台查看WCP 的 DOM 树, 会发现类似以下结构:"}]},{"type":"element","tag":"code","props":{"className":["language-html"],"code":"<hello-world>\n  #shadow-root (open)\n    <div>\n      Hello World\n    </div>\n</hello-world>\n","language":"html","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"hello-world"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  #shadow-root (open)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    <"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      Hello World\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    </"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"hello-world"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"#shadow-root"}]},{"type":"text","value":" 表明这是一个 shadow DOM. 你可以将 shadow DOM 理解为一种封装容器, 它将一组元素与其他元素隔离.\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"element-attachShadow({mode: 'open'})"}]},{"type":"text","value":" 方法用于将 shadow-root 附加到任何一个元素上. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"mode"}]},{"type":"text","value":" 字段可以取"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"open或closed"}]},{"type":"text","value":"(代表元素是否可被 JavaScript 操作)."}]},{"type":"element","tag":"h2","props":{"id":"生命周期"},"children":[{"type":"text","value":"生命周期"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"wcp 有许多现代前端框架的特性, 例如生命周期. 在 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Vue"}]},{"type":"text","value":" 中, 组件拥有"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"onBeforeMount(DOM挂载前)、onMounted(DOM挂载后)"}]},{"type":"text","value":"等生命周期.\nwcp 有以下生命周期:"}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"回调函数"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"描述"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"connectedCallback"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"首次插入页面时调用"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"disconnectedCallback"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"从页面中删除时调用"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"adoptedCallback"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"移动到新页面时调用"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"attributeChangedCallback"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"增加、删除、修改自身属性时调用"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"例如我们希望组件被删除时弹窗:"}]},{"type":"element","tag":"code","props":{"className":["language-js"],"code":"class CustomComponent extends HTMLElement {\n  constructor() {\n    // ...\n  }\n\n  disconnectedCallback() {\n    window.alert(name + 'is removed')\n  }\n}\n","language":"js","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"CustomComponent"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"extends"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"HTMLElement"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"constructor"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"disconnectedCallback"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    window."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"alert"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(name "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'is removed'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"简化操作"},"children":[{"type":"text","value":"简化操作"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"不少文章都会选择用上面这种方式: JS 的 DOM API 去各种"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"createElement appendChild"}]},{"type":"text","value":", 或者用"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"getElementById"}]},{"type":"text","value":"之类的的 api 获取 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"<template>"}]},{"type":"text","value":" 标签的内容, 但我个人觉得这实在是太操蛋了. (类似操作可见"},{"type":"element","tag":"a","props":{"href":"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_components/Using_custom_elements","rel":["nofollow"]},"children":[{"type":"text","value":"MDN"}]},{"type":"text","value":")\n如果你有一个需要复用的 Button. 上面这种做法就要求所有用到的页面都复制一份 Button 的 template, 还谈个屁的封装, 理想状态下一个(或多个)组件应该被包含在一个 js 文件中.\n有一种比较好的做法是封装一个"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"用组件名和模板内容字符串就可以创建组件"}]},{"type":"text","value":"的工具方法:"}]},{"type":"element","tag":"code","props":{"className":["language-js"],"code":"const useWebComponent = ({name, templateInner}) => {\n  window.customElements.define(name, // 注册\n    class CustomComponent extends HTMLElement {\n      constructor() {\n        super()\n        this.attachShadow({mode: 'open'})\n        const template = document.createElement('template') // 创建模板元素\n        template.innerHTML = templateInner\n        this.shadowRoot.append(template.content) // 拼接\n      }\n  })\n}\n\nconst batchRegister = (param) => { // 批量注册, param 为数组\n  param.forEach((item) => {\n    useWebComponent({name: item.name, templateInner: item.templateInner})\n  })\n}\n\nconst helloWorldInner = `\n  <div style=\"\n    color: cornflowerblue;\n    font-size: 18px;\n    \">\n    Hello World\n  </div>\n`\n\nconst cardInner = `\n  <div>\n    <div>Just a test</div>\n  </div>\n`\n\nconst componentList = [\n  {name: 'hello-world', templateInner: helloWorldInner},\n  {name: 'custom-card', templateInner: cardInner}\n]\n\nbatchRegister(componentList) // 批量注册\n","language":"js","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"useWebComponent"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" ({"}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"templateInner"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}) "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  window.customElements."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"define"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(name, "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 注册\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"CustomComponent"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"extends"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"HTMLElement"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"constructor"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"super"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"attachShadow"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({mode: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'open'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" document."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"createElement"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'template'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 创建模板元素\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        template.innerHTML "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" templateInner\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":".shadowRoot."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"append"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(template.content) "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 拼接\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"batchRegister"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"param"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 批量注册, param 为数组\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  param."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"forEach"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"useWebComponent"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({name: item.name, templateInner: item.templateInner})\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"helloWorldInner"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"`\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"  <div style=\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"    color: cornflowerblue;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"    font-size: 18px;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"    \">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"    Hello World\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"  </div>\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"`\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"cardInner"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"`\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"  <div>\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"    <div>Just a test</div>\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"  </div>\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"`\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"componentList"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  {name: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'hello-world'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", templateInner: helloWorldInner},\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  {name: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'custom-card'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", templateInner: cardInner}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"batchRegister"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(componentList) "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 批量注册"}]}]}]}]}]},{"type":"element","tag":"code","props":{"className":["language-html"],"code":"<script src=\"./index.js\"></script>\n\n<div>\n  <hello-world></hello-world>\n  <custom-card></custom-card>\n</div>\n","language":"html","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"src"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"./index.js\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"></"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  <"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"hello-world"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"></"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"hello-world"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  <"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"custom-card"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"></"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"custom-card"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"class":"ct-735963"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 webstorm 下,  形如"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"innerHTML"}]},{"type":"text","value":"的字符串会被自动识别为 HTML 元素, 有代码提示和着色, vsocde 用户可以安装"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"inline HTML"}]},{"type":"text","value":"插件."}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"其实 Web Components 非常适合作为前端框架的"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"底层组件"}]},{"type":"text","value":", 如果你只是想实现一个轻量化的框架而不是一整套解决方案的话, 编译到 Web Components 就非常合适. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"lit"}]},{"type":"text","value":"就是这种思路的产物."}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-212337{color:#E1E4E8;}\n.light .ct-212337{color:#24292E;}\n.ct-735963{color:#85E89D;}\n.light .ct-735963{color:#22863A;}\n.ct-941699{color:#B392F0;}\n.light .ct-941699{color:#6F42C1;}\n.ct-695486{color:#9ECBFF;}\n.light .ct-695486{color:#032F62;}\n.ct-782603{color:#6A737D;}\n.ct-984823{color:#F97583;}\n.light .ct-984823{color:#D73A49;}\n.ct-055721{color:#79B8FF;}\n.light .ct-055721{color:#005CC5;}\n.ct-880416{color:#FFAB70;}\n.light .ct-880416{color:#E36209;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"customelementsdefine","depth":2,"text":"customElements.define"},{"id":"template","depth":2,"text":"template"},{"id":"slot","depth":2,"text":"slot"},{"id":"shadow-dom","depth":2,"text":"shadow DOM"},{"id":"生命周期","depth":2,"text":"生命周期"},{"id":"简化操作","depth":2,"text":"简化操作"}]}},"_type":"markdown","_id":"content:1694241377468.md","_source":"content","_file":"1694241377468.md","_extension":"md"},{"_path":"/1694247812862","_dir":"","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"并发与并行","description":"这是一篇小短文, 白话文给自己归纳关于并发和并行的知识.","cover":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202309091659266.png","body":{"type":"root","children":[{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这是一篇小短文, 白话文给自己归纳所学."}]}]},{"type":"element","tag":"h1","props":{"id":"并发"},"children":[{"type":"text","value":"并发"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"假设有一个处理器, 因为只有一个核心, 所以同时他只能运行一个进程, 又因为一个进程上同一时间只能运行一个线程(task). 所以你可以认为, 同一时间, 这颗处理器只能处理一个任务."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"操作系统会将"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"cpu 使用时间"}]},{"type":"text","value":"这一资源进行切分, 这就是"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"时间分片"}]},{"type":"text","value":". 划分好的资源会按照调度算法分配给各个线程去使用. 进程内线程切换大概就是下面这种感觉:\n"},{"type":"element","tag":"img","props":{"alt":"线程调度","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202309091531790.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"因为现代计算机性能足够强劲, 所以使用者体感上是 task_1、2、3 在同时运行, 这就是并发."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我并不想用"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"「多个任务同时发生」"}]},{"type":"text","value":"这种模糊的表达, 在我看来"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"「并发」"}]},{"type":"text","value":"之所以被称为"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"「并发」"}]},{"type":"text","value":"单纯是翻译后中文表达的问题."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"无论如何, 同时确实只有一个任务在进行"}]}]},{"type":"element","tag":"h1","props":{"id":"并行"},"children":[{"type":"text","value":"并行"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"并行就要好理解的多, 你有一个多核心处理器, 例如拥有两个核心的老古董E6600. 因为有两个核心, 同时能运行两个进程, 每个进程可以运行一个线程. 因此, 你的电脑就能真正的在同一时间运行两个任务."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n大概就是下面这种感觉:\n"},{"type":"element","tag":"img","props":{"alt":"并行","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202309091547730.png"},"children":[]}]},{"type":"element","tag":"h1","props":{"id":"程序设计"},"children":[{"type":"text","value":"程序设计"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"之前刷知乎时, 看到这样一种说法:"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"「你的程序首先必须支持并发, 才能支持并行」"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n因为并发不仅是对程序执行状态的一种描述, 也是一种程序设计的方法论:"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n设计并发程序的条件就是"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"「程序的执行不依赖先后顺序、不依赖精确时序」"}]},{"type":"text","value":"."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n而一段不依赖先后顺序、不依赖精确时序的程序, 自然可以拆分成多段, 在多个线程上运行. 这多个线程又可以运行在不同的进程之上, 进而实现"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"并行"}]},{"type":"text","value":"."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:1694247812862.md","_source":"content","_file":"1694247812862.md","_extension":"md"},{"_path":"/1694340688292","_dir":"","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"单线程并发","description":"小短文, 讨论单线程并发和 node.js 这样异步协程模型的优势","cover":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202309092206004.png","body":{"type":"root","children":[{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"本文封面和思路来源于 Ruby China 2021 By 东仙队长的分享: "},{"type":"element","tag":"a","props":{"href":"https://www.bilibili.com/video/BV1h3411v7kq/?spm_id_from=333.999.0.0&vd_source=371668a779fa4a755fcbf62901a22d71","rel":["nofollow"]},"children":[{"type":"text","value":"Ruby 高并发编程指北"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在"},{"type":"element","tag":"a","props":{"href":"https://ray-d-song.com/post/1694247812862","rel":["nofollow"]},"children":[{"type":"text","value":"并发与并行"}]},{"type":"text","value":"这篇文章中, 我假设了只有一个处理器, 这颗处理器只有一个核心的情况.\n在这种情况下, 计算机同一时间只能处理一个任务. 那么如何将这个线程利用率最大化就是"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"「单线程并发」"}]},{"type":"text","value":"的课题."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"首先我们来看看最常见的 web 应用场景, 从接收到用户请求到返回, 需要这些步骤:\n"},{"type":"element","tag":"img","props":{"alt":"web app","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202309092334861.png"},"children":[]},{"type":"text","value":"\n其中"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"DB operation"}]},{"type":"text","value":"占据了最大的空间, 因为数据库操作确实是最耗时的操作."}]},{"type":"element","tag":"h1","props":{"id":"多线程并发"},"children":[{"type":"text","value":"多线程并发"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我们来假设一种极端的情况, 如果一直只有一个线程在运行, 那么运行过程就会变成这样:\n"},{"type":"element","tag":"img","props":{"alt":"单线程","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202309092339287.png"},"children":[]},{"type":"text","value":"\n如果是这样的话, 我想我们这台单核的机器没几个用户就 burn out 了.\n应对这种情况, 最简单的思路就是多开几个线程, 虽然我们只有一个进程, 但当第一个线程卡在数据库操作时, 可以将控制权转移到其他线程进行操作.\n"},{"type":"element","tag":"img","props":{"alt":"多线程","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202309092351360.png"},"children":[]}]},{"type":"element","tag":"h1","props":{"id":"协程"},"children":[{"type":"text","value":"协程"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"多线程并发, 一切看起来都很美好, 但有两个问题, 一个是计算机能启动的线程数量是有限的, 还有就是线程的切换有着客观的成本.\n那么如果我们可以自己在程序中"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"模拟线程"}]},{"type":"text","value":", 切换的不再是线程, 而是执行的程序方法. 岂不是可以用极低的成本去并发?\n这个模拟线程, 或者说"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"轻量线程/用户线程"}]},{"type":"text","value":", 就是协程.\n有了协程, 我们可以更细粒度的控制程序的执行. 以下是 node.js 协程(async异步)的例子:"}]},{"type":"element","tag":"code","props":{"className":["language-js"],"code":"async function App(request, response) {\n  const id = request.query.id // <- read req and parsing\n  try {\n    const result = await DB.find({ id }) // <- DB operation\n    res.json({ // generate json and response\n      code: 200,\n      data: result\n    })\n  } catch(e) {\n    // ...\n  }\n}\n","language":"js","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"App"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"request"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"response"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"id"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" request.query.id "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// <- read req and parsing\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"result"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"DB"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"find"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({ id }) "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// <- DB operation\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    res."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"json"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({ "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// generate json and response\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      code: "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"200"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      data: result\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(e) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"当程序执行到"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":"标识的数据库操作时, 就会在当前方法内形成阻塞, 等待数据库的返回结果. 但对于调用 App() 的方法来说, 程序则会继续向下执行(处理其他的请求)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"整个过程的简略图大概如下:\n"},{"type":"element","tag":"img","props":{"alt":"async","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202309101809693.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"关于协程更具体的介绍, 可以看我的这篇文章"},{"type":"element","tag":"a","props":{"href":"https://ray-d-song.com/post/1692667782462","rel":["nofollow"]},"children":[{"type":"text","value":"协程(Coroutine)和纤程(Fiber)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"实际上这种"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"单线程+协程"}]},{"type":"text","value":"并发模型, 就是 Node.js 的并发模型.\n这几年协程的火爆, jdk21、php8 都支持了协程方案. 足以提现这种模式的优势."}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"说到这里, 有没有什么比单线程异步并发更强的方案呢?\n那就是"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"多线程+协程"}]},{"type":"text","value":", Go 就是这样的方案. Go 实现了一种更复杂的 Goroutine 到实际线程资源的映射, 使其可以以极低的配置达到恐怖的并发性能"}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-984823{color:#F97583;}\n.light .ct-984823{color:#D73A49;}\n.ct-212337{color:#E1E4E8;}\n.light .ct-212337{color:#24292E;}\n.ct-941699{color:#B392F0;}\n.light .ct-941699{color:#6F42C1;}\n.ct-880416{color:#FFAB70;}\n.light .ct-880416{color:#E36209;}\n.ct-055721{color:#79B8FF;}\n.light .ct-055721{color:#005CC5;}\n.ct-782603{color:#6A737D;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:1694340688292.md","_source":"content","_file":"1694340688292.md","_extension":"md"},{"_path":"/1701870426245","_dir":"","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Vue 使用 Vitest进行单元测试","description":"笔者过去并没有写过前端单测, 只在例如 Go 这样社区大力推崇 TDD 的语言中实践过, 最近遇到很多前端通过人肉测试难以覆盖的场景, 因此尝试 vitest.","cover":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312141754429.png","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"单元测试的定义"},"children":[{"type":"text","value":"单元测试的定义"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"单元测试（英语：Unit Testing）又称为模块测试 "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"来源请求"}]},{"type":"text","value":" ，是针对程序模块（软件设计的最小单位）来进行正确性检验的测试工作。程序单元是应用的最小可测试部件。在过程化编程中，一个单元就是单个程序、函数、过程等；对于面向对象编程，最小单元就是方法，包括基类（超类）、抽象类、或者派生类（子类）中的方法。     ———wiki"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在一个典型的 Vue 项目中, 我们经常需要进行单元测试的模块包括以下几种:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"hooks"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"工具函数 (utils)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"校验规则 (reg)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"脚手架 (bin/scaffold)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"自定义 vue 指令"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"全局状态 (store)"}]}]},{"type":"element","tag":"h1","props":{"id":"初始化-vitest"},"children":[{"type":"text","value":"初始化 Vitest"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"安装 Vitest"}]},{"type":"element","tag":"code","props":{"className":["language-bash"],"code":"pnpm add -D vitest\n","language":"bash","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"pnpm"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"add"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"-D"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"vitest"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vitest 默认和 Vite 配置集成, 不需要额外的配置文件."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n修改"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"package.json"}]},{"type":"text","value":", 在"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"script"}]},{"type":"text","value":"下新增"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"test:unit"}]},{"type":"text","value":"命令"}]},{"type":"element","tag":"code","props":{"className":["language-json"],"code":"  \"scripts\": {\n    ...\n    \"test:unit\": \"vitest\",\n  },\n","language":"json","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"scripts\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":": {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-338738"},"children":[{"type":"text","value":"...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"\"test:unit\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"vitest\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  },"}]}]}]}]}]},{"type":"element","tag":"h1","props":{"id":"编写测试用例"},"children":[{"type":"text","value":"编写测试用例"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"测试一个手机号校验函数"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /reg/phone.ts */\n// 校验是否国内手机号\nexport function regChinesePhoneNumber(phoneNumber: string) {\n  const regex = /^1[3456789]\\d{9}$/\n  return regex.test(phoneNumber)\n}\n\n/** /reg/phone.test.ts */\nimport { describe, expect, test } from 'vitest'\nimport { regChinesePhoneNumber } from '../phone'\n\ndescribe('phone', () => {\n  test('phone number belongs to Chinese', () => {\n    expect(regChinesePhoneNumber('17725663831')).toBe(true)\n  })\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /reg/phone.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 校验是否国内手机号\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"regChinesePhoneNumber"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"phoneNumber"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"regex"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-273446"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"^"}]},{"type":"element","tag":"span","props":{"class":"ct-273446"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"[3456789]\\d"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"{9}$"}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"/\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" regex."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(phoneNumber)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /reg/phone.test.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { describe, expect, test } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { regChinesePhoneNumber } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'../phone'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"describe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'phone'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'phone number belongs to Chinese'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"regChinesePhoneNumber"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'17725663831'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"输入命令"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm run test:unit"}]},{"type":"text","value":", 不出意外你会看到以下内容, 表明测试通过:\n"},{"type":"element","tag":"img","props":{"alt":"test result","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312071947299.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"编写测试的代码文件通常放置在"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"__test__"}]},{"type":"text","value":"文件夹中, 命名为"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"xxx.test.ts"}]},{"type":"text","value":"或"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"xxx.spec.ts"}]},{"type":"text","value":", Vitest 会自动运行所有此类命名的文件."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n编写测试的基础是"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"describe、test、expect"}]},{"type":"text","value":"关键字."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"describe"}]},{"type":"text","value":" 用于定义一个测试"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"套件"}]},{"type":"text","value":", 套件类似于 js 的模块, 用于将多个 test 封装到一起, 搭配"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"skip、only"}]},{"type":"text","value":"等 api 可以实现选择性测试等功能."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"test"}]},{"type":"text","value":" 用于声明一个测试, 接收测试名称和保存测试期望的函数."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"expect"}]},{"type":"text","value":" 用于设置断言, Vitest 默认提供基于"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"chai"}]},{"type":"text","value":"的断言, 你不知道什么是 chai 没关系, 断言是单元测试的关键助手, 后面会详细介绍"}]},{"type":"element","tag":"h1","props":{"id":"实践"},"children":[{"type":"text","value":"实践"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"接下来, 我们对几种常见的场景进行单测"}]},{"type":"element","tag":"h2","props":{"id":"hooks"},"children":[{"type":"text","value":"hooks"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"hooks 是逻辑的封装, 是最需要单测的场景."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n编辑器和表单有一个常见需求是记录上一次更改时间, 我们可以通过几行代码封装一个 hooks."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/hooks/useLastChange.ts */\nimport { watch, ref, type WatchSource } from 'vue'\nimport moment from 'moment/moment'\n\nexport function useLastChange(source: WatchSource) {\n  const lastChange = ref('')\n\n  watch(source, () => {\n    lastChange.value = moment().format('YYYY-MM-DD HH:mm:ss')\n  })\n\n  return lastChange\n}\n\n/** /src/hooks/__test__/useLastChange.test.ts */\nimport { expect, it } from 'vitest'\nimport { nextTick, ref } from 'vue'\nimport { useLastChange } from '../useLastChange'\n\nit('update lastChange when source changes', async () => {\n  const source = ref('')\n  const lastChange = useLastChange(source)\n  const snapShot01 = lastChange.value\n  source.value = 'Ray'\n  await nextTick()\n  const snapShot02 = lastChange.value\n\n  expect(snapShot01).not.toBe(snapShot02)\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/hooks/useLastChange.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { watch, ref, "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" WatchSource } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vue'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" moment "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'moment/moment'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"useLastChange"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"source"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"WatchSource"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"lastChange"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"ref"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"''"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"watch"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(source, () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    lastChange.value "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"moment"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"format"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'YYYY-MM-DD HH:mm:ss'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" lastChange\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/hooks/__test__/useLastChange.test.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { expect, it } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { nextTick, ref } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vue'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { useLastChange } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'../useLastChange'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'update lastChange when source changes'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"source"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"ref"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"''"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"lastChange"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"useLastChange"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(source)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"snapShot01"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" lastChange.value\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  source.value "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'Ray'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"nextTick"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"snapShot02"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" lastChange.value\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(snapShot01).not."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(snapShot02)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"hooks 的测试比较简单, 就是执行后比对结果. utils 和 reg 也是类似, 此处略过."}]},{"type":"element","tag":"h2","props":{"id":"scaffold"},"children":[{"type":"text","value":"scaffold"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"脚手架一般是框架自身提供的命令行工具, 用于生成模板代码, 放置于 bin 目录."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nVue 和 React 自身只提供了创建项目工具, 没有提供类似 Rails Command Line 的项目搭建工具. 因此前端spa项目的脚手架都是自己针对常见业务场景的封装."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n脚手架一般通过 npm 命令执行, 在 package.json 中添加一条命令"}]},{"type":"element","tag":"code","props":{"className":["language-json"],"code":"\"create\": \"node ./bin/create.js --type=$npm_config_type --path=$npm_config_path\n","language":"json","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"create\""}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"\"node ./bin/create.js --type=$npm_config_type --path=$npm_config_path"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"运行"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm run create --type=table --path='/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/views/TestTable.vue' "}]},{"type":"text","value":", 就会执行 /bin/index 脚本中的内容并将 type 和 path 值作为参数传递."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n编写 create 脚本:"}]},{"type":"element","tag":"code","props":{"className":["language-js"],"code":"/** /src/bin/create.js */\nimport minimist from 'minimist'\nimport { readFileSync, writeFileSync } from 'fs'\n\nfunction main() {\n  // 使用 minimist 处理参数\n  const args = minimist(process.argv.slice(2))\n  const { type, path } = args\n  let temp = ''\n  if(type === 'table') {\n    temp = readFileSync('./src/bin/dist/table', 'utf-8') \n  }\n  writeFileSync(path, temp)\n  console.log('\\n创建完成')\n}\n\nmain()\n","language":"js","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/bin/create.js */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" minimist "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'minimist'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { readFileSync, writeFileSync } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'fs'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 使用 minimist 处理参数\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"args"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"minimist"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(process.argv."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"slice"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"path"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" args\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" temp "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"''\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(type "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"==="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    temp "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"readFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'./src/bin/dist/table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'utf-8'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"writeFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(path, temp)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  console."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"创建完成'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"脚手架其实只进行 3 个操作, 获取参数, 读取对应的模板, 创建目标文件."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nvitest 和 jest 并没有比较好的执行 npm 命令的方法, 因此我们要对上面的方法稍加改造:"}]},{"type":"element","tag":"code","props":{"className":["language-js"],"code":"/** /src/bin/create.js */\nimport { readFileSync, writeFileSync } from 'fs'\n\nfunction create(args) {\n  const { type, path } = args\n  let temp = ''\n  if(type === 'table') {\n    temp = readFileSync('./src/bin/dist/table', 'utf-8') \n  } else {\n    throw '当前仅支持生成 table 类型'\n  }\n  writeFileSync(path, temp)\n  console.log('\\n创建完成')\n}\n\nexport default create\n\n/** /src/bin/index.js */\nimport create from './create'\n\n// 使用 minimist 处理参数\nconst args = minimist(process.argv.slice(2))\ntry {\n  create(args)\n} catch(e) {\n  console.log(e)\n}\n","language":"js","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/bin/create.js */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { readFileSync, writeFileSync } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'fs'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"args"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"path"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" args\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" temp "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"''\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(type "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"==="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    temp "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"readFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'./src/bin/dist/table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'utf-8'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"throw"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'当前仅支持生成 table 类型'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"writeFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(path, temp)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  console."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"创建完成'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" create\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/bin/index.js */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" create "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'./create'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 使用 minimist 处理参数\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"args"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"minimist"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(process.argv."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"slice"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(args)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"} "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(e) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  console."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(e)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"将脚本入口和执行方法分离是为了防止 unit test 过程中自动执行 main 方法报错."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n接下来我们就可以在 test 中导入 create 方法进行测试. 断言可以通过读取生成的模板内容和 table 文件中内容进行比较."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n以下是测试用例, 从参数、生成内容进行测试"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/bin/__test__/create.test.ts */\nimport create from '../create'\nimport { describe, expect, it } from 'vitest'\nimport { readFileSync } from 'fs'\n\ndescribe('bin scaffold module', () => {\n\n  describe('create table error args', () => {\n    it('error temp type', () => {\n      try {\n        create({\n          type: 'dialog',\n          path: '/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/dialog.vue'\n        })\n      } catch(e) {\n        expect(e).toBe('当前仅支持生成 table 类型')\n        const product = readFileSync('/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/dialog.vue', 'utf-8')\n        expect(product).toBeUndefined\n      }\n    })\n  })\n\n  it('create table', () => {\n    create({\n      type: 'table',\n      path: '/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/table.vue'\n    })\n    const temp = readFileSync('/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/dist/table', 'utf-8')\n    const product = readFileSync('/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/table.vue', 'utf-8')\n    expect(temp).toBe(product)\n  })\n\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/bin/__test__/create.test.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" create "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'../create'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { describe, expect, it } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { readFileSync } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'fs'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"describe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'bin scaffold module'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"describe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'create table error args'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'error temp type'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"          type: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'dialog'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"          path: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/dialog.vue'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(e) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(e)."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'当前仅支持生成 table 类型'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"product"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"readFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/dialog.vue'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'utf-8'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(product).toBeUndefined\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'create table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      type: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      path: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/table.vue'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"temp"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"readFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/dist/table'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'utf-8'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"product"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"readFileSync"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'/Users/ray-d-song/temp/SourceCode/vitest-tutorial-sourcecode/src/bin/__test__/table.vue'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'utf-8'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(temp)."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(product)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"result","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312121120257.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"自定义-vue-指令"},"children":[{"type":"text","value":"自定义 Vue 指令"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"自定义一个 v-debounce, 用于给按钮增加防抖效果"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"import _ from 'lodash'\n\nconst vDebounce = {\n  beforeMount(el: HTMLElement, binding: {value: () => void}) {\n    el.addEventListener('click', _.debounce(binding.value, 600))\n  }\n}\n\napp.directive('debounce', vDebounce)\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" _ "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'lodash'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"vDebounce"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"beforeMount"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"el"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"HTMLElement"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"binding"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    el."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"addEventListener"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'click'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", _."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"debounce"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(binding.value, "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"600"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"app."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"directive"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'debounce'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", vDebounce)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"为了测试这个指令, 我们需要模拟"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"组件挂载->用户点击->方法调用的过程"}]},{"type":"text","value":", 也就是我们需要调用部分组件测试的能力. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"@vue/test-utils"}]},{"type":"text","value":" 是常用的 Vue 组件测试库."}]},{"type":"element","tag":"code","props":{"className":["language-bash"],"code":"pnpm install @vue/test-utils\n","language":"bash","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"pnpm"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"install"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"@vue/test-utils"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"vue-test-utils 兼容 jest 和 Vitest, 安装后可以直接使用. 下面是自定义指令的功能测试:"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/utils/__test__/directives.test.ts */\nimport { describe, expect, it } from 'vitest'\nimport { defineComponent, nextTick, ref } from 'vue'\nimport { mount } from '@vue/test-utils'\nimport { vDebounce } from '../directives'\n\n// 使用 defineComponent 定义测试组件\n// 该 api 除了 template 作为字符串传递外\n// 还可以使用 tsx 获得更好的代码提示\nconst tc = defineComponent({\n  setup() {\n    const num = ref(0)\n    function add() {\n      num.value++\n    }\n    return {\n      num,\n      add  \n    }\n  },\n  template: '<button v-debounce=\"add\">num: {{num}}</button>'\n})\n\ndescribe('custom directives', async () => {\n  // vue-test-utils 的 mount api, 将组件实例化\n  it('debounce submit', async () => {\n    const wrapper = mount(tc, {\n      global: {\n        directives: {\n          debounce: vDebounce\n        }\n      }\n    })\n\n    // 每过 200 毫秒点击一次 button\n    const interval = setInterval(async () => {\n      // find api 查找目标元素\n      await wrapper.find('button').trigger('click')\n    }, 200)\n    // 阻塞 1000 秒, 让点击事件在 1 秒内执行 4 次\n    await new Promise(resolve => setTimeout(resolve, 1000))\n\n    clearInterval(interval)\n\n    // 阻塞 700 秒, 等待函数执行\n    await new Promise(resolve => setTimeout(resolve, 700))\n    // 确保组件重新渲染\n    await nextTick()\n    // 获取目标元素\n    const btn = wrapper.get('button')\n    // 对目标元素的文本进行断言\n    expect(btn.text()).toBe('num: 1')\n  })\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/utils/__test__/directives.test.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { describe, expect, it } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { defineComponent, nextTick, ref } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vue'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { mount } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'@vue/test-utils'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { vDebounce } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'../directives'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 使用 defineComponent 定义测试组件\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 该 api 除了 template 作为字符串传递外\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 还可以使用 tsx 获得更好的代码提示\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"tc"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"defineComponent"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"setup"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"num"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"ref"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"add"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      num.value"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"++\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      num,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      add  \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  template: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'<button v-debounce=\"add\">num: {{num}}</button>'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"describe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'custom directives'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// vue-test-utils 的 mount api, 将组件实例化\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'debounce submit'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"wrapper"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"mount"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(tc, {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      global: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        directives: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"          debounce: vDebounce\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 每过 200 毫秒点击一次 button\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"interval"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"setInterval"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// find api 查找目标元素\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" wrapper."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"find"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'button'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"trigger"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'click'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }, "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"200"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 阻塞 1000 秒, 让点击事件在 1 秒内执行 4 次\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":41},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"setTimeout"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(resolve, "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"1000"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":42},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":43},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"clearInterval"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(interval)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":44},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":45},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 阻塞 700 秒, 等待函数执行\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":46},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"setTimeout"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(resolve, "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"700"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":47},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 确保组件重新渲染\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":48},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"nextTick"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":49},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 获取目标元素\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":50},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"btn"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" wrapper."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'button'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":51},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 对目标元素的文本进行断言\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":52},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(btn."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"text"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"())."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'num: 1'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":53},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":54},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"store"},"children":[{"type":"text","value":"store"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"大型的前端项目基本都会用到全局的状态管理库, Vue3 最流行的是 Pinia."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nPinia 提供了可用于测试的 api."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"import { createPinia, setActivePinia } from 'pinia'\nimport { beforeEach, describe, expect, it } from 'vitest'\nimport { useCounterStore } from '../counter'\n\ndescribe('Counter Store', () => {\n  beforeEach(() => {\n    setActivePinia(createPinia())\n  })\n\n  it('increments', () => {\n    const counter = useCounterStore()\n    expect(counter.count).toBe(0)\n    counter.increment()\n    expect(counter.count).toBe(1)\n  })\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { createPinia, setActivePinia } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'pinia'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { beforeEach, describe, expect, it } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { useCounterStore } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'../counter'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"describe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'Counter Store'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"beforeEach"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"setActivePinia"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"createPinia"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'increments'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"counter"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"useCounterStore"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(counter.count)."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    counter."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"increment"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(counter.count)."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这里引入了一个新的 api: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"beforeEach"}]},{"type":"text","value":", 这是一种"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"测试生命周期钩子"}]},{"type":"text","value":", 传入的方法在每个测试用例之前执行."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n我们传入了 pinia 的 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"setActivePinia"}]},{"type":"text","value":" api, 这是个 SSR 经常使用的 api, 用户设置一个激活的 Pinia 实例."}]},{"type":"element","tag":"h1","props":{"id":"断言"},"children":[{"type":"text","value":"断言"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"断言是单元测试的核心, 本质一堆用来判断结果的函数库."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n在上面的例子, 我们使用了"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"toBe"}]},{"type":"text","value":"断言, 这是最常用的断言, 该断言用于判断值相等或者相同引用, 类似于"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Object.is"}]},{"type":"text","value":"."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n以下为常用的几种断言:"}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"断言"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"功能"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"not"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"取反"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"判断值或对象引用是否相同"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toEqual"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"判断对象值是否相同"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBeGreaterThan"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"大于"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBeGreaterThanOrEqual"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"大于等于"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBeLessThan"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"小于"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBeLessThanOrEqual"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"小于等于"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"soft"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"expect.soft"}]},{"type":"text","value":" 遇到某条用例失败也不会停止测试, 直到所有用例执行完毕展示所有错误"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBeTypeOf"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"断言类型是否相同"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toBeInstanceOf"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"判断是否是目标类的实例"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toStrictEqual"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"严格相等, 会检查具有 undefined 属性的 key、数组稀疏性、对象类型是否相等"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toContain"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"检查数组元素和子串"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"toThrowError"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"检查函数调用过程中是否报错"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"resolves"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"expect(func()).resolves.toEqual"}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"rejects"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"expect(func()).rejects.toThrow"}]}]}]}]}]},{"type":"element","tag":"h1","props":{"id":"mock"},"children":[{"type":"text","value":"mock"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"为了应对业务耦合, 做到仅测试功能代码, 我们可以使用 mock 工具进行数据模拟."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n最常见的场景是模拟请求, 一般情况下你可以自己用一个 Promise 来模拟请求结果, 但有些情况也许你需要更真实的场景."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n常用的 mock 工具, 例如 APIfox, 是通过接口定义来「启动一个真实的服务器返回假数据」. 而 Vitest 并不会启动真正的 node 服务器, 而是通过"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"mswjs"}]},{"type":"text","value":"来拦截对应地址的请求."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n也就是说你可以很方便的去模拟「异常请求」的场景."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n首先安装 msw: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pnpm install msw"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"假设我们需要请求"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"https://thorn.mock/test"}]},{"type":"text","value":"这个接口, 获取"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"{msg: 'hey'}"}]},{"type":"text","value":"的 json 数据, 以下是我们的测试用例."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/api/__test__/mock.test.ts */\nimport { describe, expect, it } from 'vitest'\n\ndescribe('mock', async () => {\n  it('mock api', async () => {\n    const response = await fetch('https://thorn.mock/test') \n    // 使用 toEqual 来比较对象值\n    expect(await response.json()).toEqual({\n      msg: 'hey'\n    })\n  })\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/api/__test__/mock.test.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { describe, expect, it } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"describe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'mock'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'mock api'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"response"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"fetch"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'https://thorn.mock/test'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 使用 toEqual 来比较对象值\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" response."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"json"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"())."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toEqual"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      msg: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'hey'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"为了 mock 这个接口, 我们需要按照 msw 的语法编写一个 server."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/mocks/server.ts */\nimport { setupServer } from 'msw/node'\nimport { HttpHandler, HttpResponse, http } from 'msw'\n\nexport const handlers: Array<HttpHandler> = [\n  http.get('https://thorn.mock/test', () => {\n    return HttpResponse.json({\n      msg: 'hey'\n    })\n  })\n]\n\nexport const server = setupServer(...handlers)\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/mocks/server.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { setupServer } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'msw/node'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { HttpHandler, HttpResponse, http } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'msw'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"handlers"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Array"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"HttpHandler"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  http."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'https://thorn.mock/test'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" HttpResponse."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"json"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      msg: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'hey'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"server"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"setupServer"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"handlers)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"理想状况下, 我们希望每一次测试开始都启动 mock 服务器, 测试结束将服务关掉, Vitest 提供了四个 api 来实现这个过程."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n在 Vitest.config.ts 中, 添加 setupFiles 选项, 该选项接受"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"string|string[]"}]},{"type":"text","value":"作为文件路径, 写入的文件每次 Vitest 启动都会自动执行."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"defineConfig({\n  test: {\n    // ...\n    setupFiles: './src/setup.ts'\n    // ...\n  }\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"defineConfig"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  test: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    setupFiles: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'./src/setup.ts'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 setup.ts 文件中, 我们调用 Vitest 钩子:"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"import { server } from './mocks/server'\nimport { beforeAll, afterAll, afterEach } from 'vitest'\n\n// 在每一次测试开始前开启服务器\nbeforeAll(() => server.listen({ onUnhandledRequest: 'error' }))\n// 在每一次测试结束后关闭服务器\nafterAll(() => server.close())\n// 在每一个用例结束后重置 handlers\nafterEach(() => server.resetHandlers())\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { server } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'./mocks/server'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { beforeAll, afterAll, afterEach } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 在每一次测试开始前开启服务器\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"beforeAll"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" server."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({ onUnhandledRequest: "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'error'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" }))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 在每一次测试结束后关闭服务器\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"afterAll"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" server."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"close"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 在每一个用例结束后重置 handlers\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"afterEach"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" server."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"resetHandlers"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"())"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"开启测试, 会显示测试已通过."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"img","props":{"alt":"unit test pass","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312141529162.png"},"children":[]},{"type":"text","value":"\n请注意, 因为 msw 的作用是拦截请求而不是开启模拟服务器, 因此直接本地调用并不起作用."}]},{"type":"element","tag":"h1","props":{"id":"异步测试"},"children":[{"type":"text","value":"异步测试"}]},{"type":"element","tag":"h1","props":{"id":"优化测试过程"},"children":[{"type":"text","value":"优化测试过程"}]},{"type":"element","tag":"h2","props":{"id":"内联测试"},"children":[{"type":"text","value":"内联测试"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"就和内联样式表一样, 所谓内联测试就是将测试代码和源码写在一起."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n改造一下正则表达式的例子:"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/reg/phone.ts */\nexport function regChinesePhoneNumber(phoneNumber: string) {\n  const regex = /^1[3456789]\\d{9}$/\n  return regex.test(phoneNumber)\n}\n\n// 内联测试应该放在源码的底部\n/**\n * 为了解决 ts 报错\n * 需要在 tsconfig.json 中添加\n * {\"compilerOptions\": {\"types\": [\"vitest/importMeta\"]}}\n */\nif(import.meta.vitest) {\n  const { it, expect } = import.meta.vitest\n  it('phone number belongs to Chinese', () => {\n    expect(regChinesePhoneNumber('41772566381')).toBe(false)\n  })\n}\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/reg/phone.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"regChinesePhoneNumber"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"phoneNumber"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"regex"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-273446"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"^"}]},{"type":"element","tag":"span","props":{"class":"ct-273446"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"[3456789]\\d"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"{9}$"}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"/\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" regex."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"(phoneNumber)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 内联测试应该放在源码的底部\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/**\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":" * 为了解决 ts 报错\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":" * 需要在 tsconfig.json 中添加\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":" * {\"compilerOptions\": {\"types\": [\"vitest/importMeta\"]}}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":" */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"meta"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":".vitest) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"meta"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":".vitest\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"it"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'phone number belongs to Chinese'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expect"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"regChinesePhoneNumber"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'41772566381'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"))."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"随后更新一下"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"vitest.config.ts"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"export default defineConfig({\n  test: {\n    includeSource: ['src/**/*.{js,ts}'], \n  }\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"defineConfig"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  test: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    includeSource: ["}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'src/**/*.{js,ts}'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"], \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可以看到新运行的用例增加了一个非"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"test.ts"}]},{"type":"text","value":"结尾的文件."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"img","props":{"alt":"in source test","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312141609782.png"},"children":[]},{"type":"text","value":"\n这样做的缺点是会造成打包后的代码体积膨胀, 但我们可以做一些处理让代码块作为不会被执行的区块被 tree-shake 掉."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** vite.config.ts */\nexport default defineConfig({\n  define: {\n    'import.meta.vitest': 'undefined', \n  }, \n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** vite.config.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"defineConfig"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  define: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'import.meta.vitest'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'undefined'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }, \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"类型测试-experimental"},"children":[{"type":"text","value":"类型测试 (Experimental)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ts 的类型在编译后会被擦除, 也就是说无论类型代码写的有多完备, 对真正运行的 js 代码并不会有影响. 但通过类型测试可以促使类型代码更sound, 以此提高 ts 项目的强健性."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n不过总的来说类型测试并不常用, 此处仅介绍一下一般流程."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"/** /src/types/MPick.d.ts */\n// 实现一个自己的 Pick 方法\nexport type MPick<T, K extends keyof T> = {\n  [P in K]: T[P]\n}\n\n/** /src/types/__test__/MPick.test-d.ts */\n\n// vitest 会自动扫描 .test-d.ts 命令的文件\nimport { expectTypeOf, test } from 'vitest'\nimport type { MPick } from '../MPick'\n\ntest('test mock Pick', () => {\n  interface Foo {\n    a: string\n    b: number\n  }\n  type Bar = MPick<Foo, 'a'>\n  interface Exp {\n    a: string\n  }\n  expectTypeOf<Bar>().toEqualTypeOf<Exp>()\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/types/MPick.d.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// 实现一个自己的 Pick 方法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"MPick"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"T"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"K"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"extends"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"keyof"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"T"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  ["}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"P"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"K"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"]"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"T"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"["}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"P"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"/** /src/types/__test__/MPick.test-d.ts */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-782603"},"children":[{"type":"text","value":"// vitest 会自动扫描 .test-d.ts 命令的文件\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { expectTypeOf, test } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'vitest'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" { MPick } "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'../MPick'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"test"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'test mock Pick'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"interface"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Foo"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"string\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"b"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"number\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Bar"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"MPick"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Foo"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'a'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":"interface"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Exp"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-880416"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"class":"ct-984823"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"string\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"expectTypeOf"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Bar"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">()."}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"toEqualTypeOf"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"Exp"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":">()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"为了启动类型测试, 需要在启动时指定 --typecheck, 添加一个新的 npm 命令 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"\"test:type\": \"vitest --typecheck\""}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n运行"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pnpm run test:type"}]},{"type":"text","value":"运行测试"}]},{"type":"element","tag":"h2","props":{"id":"可视化"},"children":[{"type":"text","value":"可视化"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vitest 提供了 UI 界面进行交互, 运行"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pnpm install @vitest/ui"}]},{"type":"text","value":"安装, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pnpm run test:unit --ui"}]},{"type":"text","value":" 启动\n"},{"type":"element","tag":"img","props":{"alt":"ui","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312141744611.png"},"children":[]},{"type":"text","value":"\n里面涵盖了几乎所有的操作, 还可以查看 console、源码和依赖图.\n"},{"type":"element","tag":"img","props":{"alt":"Graph","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312141745142.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"代码覆盖率"},"children":[{"type":"text","value":"代码覆盖率"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vitest 通过 V8 提供代码覆盖率检查, 运行"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pnpm install @vitest/coverage-v8"}]},{"type":"text","value":"安装"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n在 vitest.config 中配置覆盖率选项"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"defineConfig({\n  test: {\n    coverage: {\n      enabled: true,\n      reporter: ['html']\n    }\n  }\n})\n","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-941699"},"children":[{"type":"text","value":"defineConfig"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  test: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    coverage: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      enabled: "}]},{"type":"element","tag":"span","props":{"class":"ct-055721"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"      reporter: ["}]},{"type":"element","tag":"span","props":{"class":"ct-695486"},"children":[{"type":"text","value":"'html'"}]},{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-212337"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这样就可以在 ui 界面上看到代码覆盖率结果了"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"img","props":{"alt":"coverage ui","src":"https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202312141752020.png"},"children":[]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-941699{color:#B392F0;}\n.light .ct-941699{color:#6F42C1;}\n.ct-212337{color:#E1E4E8;}\n.light .ct-212337{color:#24292E;}\n.ct-695486{color:#9ECBFF;}\n.light .ct-695486{color:#032F62;}\n.ct-055721{color:#79B8FF;}\n.light .ct-055721{color:#005CC5;}\n.ct-338738{color:#FDAEB7;font-style:italic;}\n.light .ct-338738{color:#B31D28;font-style:italic;}\n.ct-782603{color:#6A737D;}\n.ct-984823{color:#F97583;}\n.light .ct-984823{color:#D73A49;}\n.ct-880416{color:#FFAB70;}\n.light .ct-880416{color:#E36209;}\n.ct-273446{color:#DBEDFF;}\n.light .ct-273446{color:#032F62;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"hooks","depth":2,"text":"hooks"},{"id":"scaffold","depth":2,"text":"scaffold"},{"id":"自定义-vue-指令","depth":2,"text":"自定义 Vue 指令"},{"id":"store","depth":2,"text":"store"},{"id":"内联测试","depth":2,"text":"内联测试"},{"id":"类型测试-experimental","depth":2,"text":"类型测试 (Experimental)"},{"id":"可视化","depth":2,"text":"可视化"},{"id":"代码覆盖率","depth":2,"text":"代码覆盖率"}]}},"_type":"markdown","_id":"content:1701870426245.md","_source":"content","_file":"1701870426245.md","_extension":"md"}],"navigation":[{"title":"协程(Coroutine)和纤程(Fiber)","_path":"/1692667782462"},{"title":"tailwind css的价值","_path":"/1693682341339"},{"title":"试试 WebComponents","_path":"/1694241377468"},{"title":"并发与并行","_path":"/1694247812862"},{"title":"单线程并发","_path":"/1694340688292"},{"title":"Vue 使用 Vitest进行单元测试","_path":"/1701870426245"}]}