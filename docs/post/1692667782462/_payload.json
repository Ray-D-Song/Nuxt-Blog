[{"data":1,"prerenderedAt":2595},["Reactive",2],{"1692667782462":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":5,"_empty":6,"title":7,"description":8,"cover":9,"body":10,"_type":2590,"_id":2591,"_source":2592,"_file":2593,"_extension":2594},"/1692667782462","",false,"协程(Coroutine)和纤程(Fiber)","最近在看 C++ 引入 Fiber 的[N4024文档: 区分纤程和协程](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4024.pdf), 文章给纤程和协程十分明确的区分. 但过去我看过的很多资料会将其混为一谈或者模糊二者的边界, 所以写了这篇博客来总结一下.","https://pic-base-1307984077.cos.ap-nanjing.myqcloud.com/202308221107239.png",{"type":11,"children":12,"toc":2583},"root",[13,32,38,43,52,57,62,89,95,113,121,126,157,163,175,1409,1414,2088,2093,2098,2103,2540,2545,2550,2563,2578],{"type":14,"tag":15,"props":16,"children":17},"element","p",{},[18,21,30],{"type":19,"value":20},"text","最近在看 C++ 引入 Fiber 的",{"type":14,"tag":22,"props":23,"children":27},"a",{"href":24,"rel":25},"https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4024.pdf",[26],"nofollow",[28],{"type":19,"value":29},"N4024文档: 区分纤程和协程",{"type":19,"value":31},", 文章给纤程和协程十分明确的区分. 但过去我看过的很多资料会将其混为一谈或者模糊二者的边界, 所以写了这篇博客来总结一下.",{"type":14,"tag":33,"props":34,"children":36},"h1",{"id":35},"纤程",[37],{"type":19,"value":35},{"type":14,"tag":15,"props":39,"children":40},{},[41],{"type":19,"value":42},"线程是一种轻量级的线程, 本质是对线程时间进行切片处理, 调度也由用户进行. 最早是 Microsoft 为了解决 Unix 平台的引用程序移植到 Windows 上时出现的问题而发起的提案.\n因此, 纤程是一种偏底层的概念, 通常由操作系统或runtime自动管理, 并不需要程序员手动干预. 例如 Windows 上的纤程就是在其内核上实现.",{"type":14,"tag":44,"props":45,"children":46},"blockquote",{},[47],{"type":14,"tag":15,"props":48,"children":49},{},[50],{"type":19,"value":51},"值得注意的是, php8 引入的 Fiber 虽然叫做纤程, 其本质是协程.",{"type":14,"tag":15,"props":53,"children":54},{},[55],{"type":19,"value":56},"一个线程可以包含多个纤程, 纤程的好处是可以有效防止长时间的线程挂起. 例如在 IO 操作时, 实例化一个纤程进行 IO 操作, 在该纤程阻塞的过程中, 因为仅占用了一部分的时间切片, 程序依旧可以继续执行.",{"type":14,"tag":33,"props":58,"children":60},{"id":59},"协程",[61],{"type":19,"value":59},{"type":14,"tag":15,"props":63,"children":64},{},[65,67,73,75,80,82,87],{"type":19,"value":66},"协程的核心就是协作, 通过明确的挂起和恢复来控制执行的流程，使得不同任务之间可以更好地协同工作，共享信息，避免竞态条件，提高性能.\n协程在许多语言中都有实现, 例如 ",{"type":14,"tag":68,"props":69,"children":70},"code-inline",{},[71],{"type":19,"value":72},"Lua、Go、Ruby、Java(Virtual Threads)",{"type":19,"value":74},", ",{"type":14,"tag":68,"props":76,"children":77},{},[78],{"type":19,"value":79},"Python 和 JavaScript(基于生成器)",{"type":19,"value":81},".\n如果要用一句话来总结协程: ",{"type":14,"tag":68,"props":83,"children":84},{},[85],{"type":19,"value":86},"控制流的主动让出和恢复",{"type":19,"value":88},".",{"type":14,"tag":90,"props":91,"children":93},"h2",{"id":92},"有栈协程和无栈协程",[94],{"type":19,"value":92},{"type":14,"tag":15,"props":96,"children":97},{},[98,100,105,107,112],{"type":19,"value":99},"协程有很多种, 按照多个协程之间是否存在调用栈, 可以分为",{"type":14,"tag":68,"props":101,"children":102},{},[103],{"type":19,"value":104},"有栈协程(如goroutine、lua协程)",{"type":19,"value":106},"和",{"type":14,"tag":68,"props":108,"children":109},{},[110],{"type":19,"value":111},"无栈协程(如JavaScript、Dart、Python)",{"type":19,"value":88},{"type":14,"tag":44,"props":114,"children":115},{},[116],{"type":14,"tag":15,"props":117,"children":118},{},[119],{"type":19,"value":120},"调用栈的作用是保存协程挂起时的状态.\n有栈协程在恢复时会将其上下文从栈内存中捞出恢复到系统栈中.\n无栈协程的挂起和恢复则依赖闭包和状态机实现.",{"type":14,"tag":90,"props":122,"children":124},{"id":123},"对称协程和非对称协程",[125],{"type":19,"value":123},{"type":14,"tag":15,"props":127,"children":128},{},[129,131,136,137,142,143,148,150,155],{"type":19,"value":130},"非对称协程提供",{"type":14,"tag":68,"props":132,"children":133},{},[134],{"type":19,"value":135},"两种控制操作",{"type":19,"value":74},{"type":14,"tag":68,"props":138,"children":139},{},[140],{"type":19,"value":141},"调用协程",{"type":19,"value":106},{"type":14,"tag":68,"props":144,"children":145},{},[146],{"type":19,"value":147},"挂起协程",{"type":19,"value":149},". 非对称协程可以看做是其调用者的从属, 跟特定调用者绑定, 在让出控制权时, 只能回到原调用者.\n对称协程提供",{"type":14,"tag":68,"props":151,"children":152},{},[153],{"type":19,"value":154},"单个控制操作",{"type":19,"value":156},", 可以通过该操作在协程之间显示的传递控制权. 对称协程在启动后和原调用者就没什么关系了, 也因此, 对称协程需要一个调度器去选择转移控制权操作的目标协程.",{"type":14,"tag":158,"props":159,"children":161},"h3",{"id":160},"对称",[162],{"type":19,"value":160},{"type":14,"tag":15,"props":164,"children":165},{},[166,168,173],{"type":19,"value":167},"对称协程的例子非常少, 以下是 C++ ",{"type":14,"tag":68,"props":169,"children":170},{},[171],{"type":19,"value":172},"Boost.Coroutine",{"type":19,"value":174}," 的示例.",{"type":14,"tag":176,"props":177,"children":182},"code",{"className":178,"code":180,"language":181,"meta":5},[179],"language-cpp","#include \u003Ciostream>\n#include \u003Ccoroutine>\n\nstruct CountingCoroutine {\n    struct promise_type {\n        int current_value = 0;\n\n        CountingCoroutine get_return_object() {\n            return CountingCoroutine(std::coroutine_handle\u003Cpromise_type>::from_promise(*this));\n        }\n\n        std::suspend_always initial_suspend() { return {}; }\n        std::suspend_always final_suspend() noexcept { return {}; }\n        void return_void() {}\n        void unhandled_exception() {}\n        std::suspend_always yield_value(int value) {\n            current_value = value;\n            return {};\n        }\n    };\n\n    std::coroutine_handle\u003Cpromise_type> coroutine;\n\n    CountingCoroutine(std::coroutine_handle\u003Cpromise_type> handle) : coroutine(handle) {}\n\n    ~CountingCoroutine() {\n        if (coroutine)\n            coroutine.destroy();\n    }\n\n    int getValue() const {\n        return coroutine.promise().current_value;\n    }\n\n    void resume() {\n        coroutine.resume();\n    }\n};\n\nCountingCoroutine generateNumbers() {\n    for (int i = 0; i \u003C 10; ++i) {\n        //移交控制权\n        co_yield i;\n    }\n}\n\nint main() {\n    CountingCoroutine counter = generateNumbers();\n\n    while (counter.coroutine) {\n        std::cout \u003C\u003C \"Value: \" \u003C\u003C counter.getValue() \u003C\u003C std::endl;\n        //回到 co_yield 继续执行\n        counter.resume();\n    }\n\n    return 0;\n}\n","cpp",[183],{"type":14,"tag":184,"props":185,"children":186},"pre",{},[187],{"type":14,"tag":176,"props":188,"children":189},{"__ignoreMap":5},[190,214,231,240,264,290,329,337,363,443,452,460,504,556,583,608,660,678,695,703,712,720,755,763,824,832,849,867,886,895,903,937,964,972,980,1005,1022,1030,1039,1047,1068,1140,1150,1168,1176,1185,1193,1214,1239,1247,1265,1334,1343,1360,1368,1376,1400],{"type":14,"tag":191,"props":192,"children":195},"span",{"class":193,"line":194},"line",1,[196,202,208],{"type":14,"tag":191,"props":197,"children":199},{"class":198},"ct-984823",[200],{"type":19,"value":201},"#include",{"type":14,"tag":191,"props":203,"children":205},{"class":204},"ct-212337",[206],{"type":19,"value":207}," ",{"type":14,"tag":191,"props":209,"children":211},{"class":210},"ct-695486",[212],{"type":19,"value":213},"\u003Ciostream>\n",{"type":14,"tag":191,"props":215,"children":217},{"class":193,"line":216},2,[218,222,226],{"type":14,"tag":191,"props":219,"children":220},{"class":198},[221],{"type":19,"value":201},{"type":14,"tag":191,"props":223,"children":224},{"class":204},[225],{"type":19,"value":207},{"type":14,"tag":191,"props":227,"children":228},{"class":210},[229],{"type":19,"value":230},"\u003Ccoroutine>\n",{"type":14,"tag":191,"props":232,"children":234},{"class":193,"line":233},3,[235],{"type":14,"tag":191,"props":236,"children":237},{},[238],{"type":19,"value":239},"\n",{"type":14,"tag":191,"props":241,"children":243},{"class":193,"line":242},4,[244,249,253,259],{"type":14,"tag":191,"props":245,"children":246},{"class":198},[247],{"type":19,"value":248},"struct",{"type":14,"tag":191,"props":250,"children":251},{"class":204},[252],{"type":19,"value":207},{"type":14,"tag":191,"props":254,"children":256},{"class":255},"ct-941699",[257],{"type":19,"value":258},"CountingCoroutine",{"type":14,"tag":191,"props":260,"children":261},{"class":204},[262],{"type":19,"value":263}," {\n",{"type":14,"tag":191,"props":265,"children":267},{"class":193,"line":266},5,[268,273,277,281,286],{"type":14,"tag":191,"props":269,"children":270},{"class":204},[271],{"type":19,"value":272},"    ",{"type":14,"tag":191,"props":274,"children":275},{"class":198},[276],{"type":19,"value":248},{"type":14,"tag":191,"props":278,"children":279},{"class":204},[280],{"type":19,"value":207},{"type":14,"tag":191,"props":282,"children":283},{"class":255},[284],{"type":19,"value":285},"promise_type",{"type":14,"tag":191,"props":287,"children":288},{"class":204},[289],{"type":19,"value":263},{"type":14,"tag":191,"props":291,"children":293},{"class":193,"line":292},6,[294,299,304,309,314,318,324],{"type":14,"tag":191,"props":295,"children":296},{"class":204},[297],{"type":19,"value":298},"        ",{"type":14,"tag":191,"props":300,"children":301},{"class":198},[302],{"type":19,"value":303},"int",{"type":14,"tag":191,"props":305,"children":306},{"class":204},[307],{"type":19,"value":308}," current_value ",{"type":14,"tag":191,"props":310,"children":311},{"class":198},[312],{"type":19,"value":313},"=",{"type":14,"tag":191,"props":315,"children":316},{"class":204},[317],{"type":19,"value":207},{"type":14,"tag":191,"props":319,"children":321},{"class":320},"ct-055721",[322],{"type":19,"value":323},"0",{"type":14,"tag":191,"props":325,"children":326},{"class":204},[327],{"type":19,"value":328},";\n",{"type":14,"tag":191,"props":330,"children":332},{"class":193,"line":331},7,[333],{"type":14,"tag":191,"props":334,"children":335},{},[336],{"type":19,"value":239},{"type":14,"tag":191,"props":338,"children":340},{"class":193,"line":339},8,[341,345,349,353,358],{"type":14,"tag":191,"props":342,"children":343},{"class":204},[344],{"type":19,"value":298},{"type":14,"tag":191,"props":346,"children":347},{"class":255},[348],{"type":19,"value":258},{"type":14,"tag":191,"props":350,"children":351},{"class":204},[352],{"type":19,"value":207},{"type":14,"tag":191,"props":354,"children":355},{"class":255},[356],{"type":19,"value":357},"get_return_object",{"type":14,"tag":191,"props":359,"children":360},{"class":204},[361],{"type":19,"value":362},"() {\n",{"type":14,"tag":191,"props":364,"children":366},{"class":193,"line":365},9,[367,372,377,381,385,390,395,400,405,410,414,419,424,428,433,438],{"type":14,"tag":191,"props":368,"children":369},{"class":204},[370],{"type":19,"value":371},"            ",{"type":14,"tag":191,"props":373,"children":374},{"class":198},[375],{"type":19,"value":376},"return",{"type":14,"tag":191,"props":378,"children":379},{"class":204},[380],{"type":19,"value":207},{"type":14,"tag":191,"props":382,"children":383},{"class":255},[384],{"type":19,"value":258},{"type":14,"tag":191,"props":386,"children":387},{"class":204},[388],{"type":19,"value":389},"(",{"type":14,"tag":191,"props":391,"children":392},{"class":255},[393],{"type":19,"value":394},"std",{"type":14,"tag":191,"props":396,"children":397},{"class":204},[398],{"type":19,"value":399},"::",{"type":14,"tag":191,"props":401,"children":402},{"class":255},[403],{"type":19,"value":404},"coroutine_handle",{"type":14,"tag":191,"props":406,"children":407},{"class":204},[408],{"type":19,"value":409},"\u003C",{"type":14,"tag":191,"props":411,"children":412},{"class":255},[413],{"type":19,"value":285},{"type":14,"tag":191,"props":415,"children":416},{"class":204},[417],{"type":19,"value":418},">::",{"type":14,"tag":191,"props":420,"children":421},{"class":255},[422],{"type":19,"value":423},"from_promise",{"type":14,"tag":191,"props":425,"children":426},{"class":204},[427],{"type":19,"value":389},{"type":14,"tag":191,"props":429,"children":430},{"class":198},[431],{"type":19,"value":432},"*",{"type":14,"tag":191,"props":434,"children":435},{"class":320},[436],{"type":19,"value":437},"this",{"type":14,"tag":191,"props":439,"children":440},{"class":204},[441],{"type":19,"value":442},"));\n",{"type":14,"tag":191,"props":444,"children":446},{"class":193,"line":445},10,[447],{"type":14,"tag":191,"props":448,"children":449},{"class":204},[450],{"type":19,"value":451},"        }\n",{"type":14,"tag":191,"props":453,"children":455},{"class":193,"line":454},11,[456],{"type":14,"tag":191,"props":457,"children":458},{},[459],{"type":19,"value":239},{"type":14,"tag":191,"props":461,"children":463},{"class":193,"line":462},12,[464,468,472,476,481,485,490,495,499],{"type":14,"tag":191,"props":465,"children":466},{"class":204},[467],{"type":19,"value":298},{"type":14,"tag":191,"props":469,"children":470},{"class":255},[471],{"type":19,"value":394},{"type":14,"tag":191,"props":473,"children":474},{"class":204},[475],{"type":19,"value":399},{"type":14,"tag":191,"props":477,"children":478},{"class":255},[479],{"type":19,"value":480},"suspend_always",{"type":14,"tag":191,"props":482,"children":483},{"class":204},[484],{"type":19,"value":207},{"type":14,"tag":191,"props":486,"children":487},{"class":255},[488],{"type":19,"value":489},"initial_suspend",{"type":14,"tag":191,"props":491,"children":492},{"class":204},[493],{"type":19,"value":494},"() { ",{"type":14,"tag":191,"props":496,"children":497},{"class":198},[498],{"type":19,"value":376},{"type":14,"tag":191,"props":500,"children":501},{"class":204},[502],{"type":19,"value":503}," {}; }\n",{"type":14,"tag":191,"props":505,"children":507},{"class":193,"line":506},13,[508,512,516,520,524,528,533,538,543,548,552],{"type":14,"tag":191,"props":509,"children":510},{"class":204},[511],{"type":19,"value":298},{"type":14,"tag":191,"props":513,"children":514},{"class":255},[515],{"type":19,"value":394},{"type":14,"tag":191,"props":517,"children":518},{"class":204},[519],{"type":19,"value":399},{"type":14,"tag":191,"props":521,"children":522},{"class":255},[523],{"type":19,"value":480},{"type":14,"tag":191,"props":525,"children":526},{"class":204},[527],{"type":19,"value":207},{"type":14,"tag":191,"props":529,"children":530},{"class":255},[531],{"type":19,"value":532},"final_suspend",{"type":14,"tag":191,"props":534,"children":535},{"class":204},[536],{"type":19,"value":537},"() ",{"type":14,"tag":191,"props":539,"children":540},{"class":198},[541],{"type":19,"value":542},"noexcept",{"type":14,"tag":191,"props":544,"children":545},{"class":204},[546],{"type":19,"value":547}," { ",{"type":14,"tag":191,"props":549,"children":550},{"class":198},[551],{"type":19,"value":376},{"type":14,"tag":191,"props":553,"children":554},{"class":204},[555],{"type":19,"value":503},{"type":14,"tag":191,"props":557,"children":559},{"class":193,"line":558},14,[560,564,569,573,578],{"type":14,"tag":191,"props":561,"children":562},{"class":204},[563],{"type":19,"value":298},{"type":14,"tag":191,"props":565,"children":566},{"class":198},[567],{"type":19,"value":568},"void",{"type":14,"tag":191,"props":570,"children":571},{"class":204},[572],{"type":19,"value":207},{"type":14,"tag":191,"props":574,"children":575},{"class":255},[576],{"type":19,"value":577},"return_void",{"type":14,"tag":191,"props":579,"children":580},{"class":204},[581],{"type":19,"value":582},"() {}\n",{"type":14,"tag":191,"props":584,"children":586},{"class":193,"line":585},15,[587,591,595,599,604],{"type":14,"tag":191,"props":588,"children":589},{"class":204},[590],{"type":19,"value":298},{"type":14,"tag":191,"props":592,"children":593},{"class":198},[594],{"type":19,"value":568},{"type":14,"tag":191,"props":596,"children":597},{"class":204},[598],{"type":19,"value":207},{"type":14,"tag":191,"props":600,"children":601},{"class":255},[602],{"type":19,"value":603},"unhandled_exception",{"type":14,"tag":191,"props":605,"children":606},{"class":204},[607],{"type":19,"value":582},{"type":14,"tag":191,"props":609,"children":611},{"class":193,"line":610},16,[612,616,620,624,628,632,637,641,645,649,655],{"type":14,"tag":191,"props":613,"children":614},{"class":204},[615],{"type":19,"value":298},{"type":14,"tag":191,"props":617,"children":618},{"class":255},[619],{"type":19,"value":394},{"type":14,"tag":191,"props":621,"children":622},{"class":204},[623],{"type":19,"value":399},{"type":14,"tag":191,"props":625,"children":626},{"class":255},[627],{"type":19,"value":480},{"type":14,"tag":191,"props":629,"children":630},{"class":204},[631],{"type":19,"value":207},{"type":14,"tag":191,"props":633,"children":634},{"class":255},[635],{"type":19,"value":636},"yield_value",{"type":14,"tag":191,"props":638,"children":639},{"class":204},[640],{"type":19,"value":389},{"type":14,"tag":191,"props":642,"children":643},{"class":198},[644],{"type":19,"value":303},{"type":14,"tag":191,"props":646,"children":647},{"class":204},[648],{"type":19,"value":207},{"type":14,"tag":191,"props":650,"children":652},{"class":651},"ct-880416",[653],{"type":19,"value":654},"value",{"type":14,"tag":191,"props":656,"children":657},{"class":204},[658],{"type":19,"value":659},") {\n",{"type":14,"tag":191,"props":661,"children":663},{"class":193,"line":662},17,[664,669,673],{"type":14,"tag":191,"props":665,"children":666},{"class":204},[667],{"type":19,"value":668},"            current_value ",{"type":14,"tag":191,"props":670,"children":671},{"class":198},[672],{"type":19,"value":313},{"type":14,"tag":191,"props":674,"children":675},{"class":204},[676],{"type":19,"value":677}," value;\n",{"type":14,"tag":191,"props":679,"children":681},{"class":193,"line":680},18,[682,686,690],{"type":14,"tag":191,"props":683,"children":684},{"class":204},[685],{"type":19,"value":371},{"type":14,"tag":191,"props":687,"children":688},{"class":198},[689],{"type":19,"value":376},{"type":14,"tag":191,"props":691,"children":692},{"class":204},[693],{"type":19,"value":694}," {};\n",{"type":14,"tag":191,"props":696,"children":698},{"class":193,"line":697},19,[699],{"type":14,"tag":191,"props":700,"children":701},{"class":204},[702],{"type":19,"value":451},{"type":14,"tag":191,"props":704,"children":706},{"class":193,"line":705},20,[707],{"type":14,"tag":191,"props":708,"children":709},{"class":204},[710],{"type":19,"value":711},"    };\n",{"type":14,"tag":191,"props":713,"children":715},{"class":193,"line":714},21,[716],{"type":14,"tag":191,"props":717,"children":718},{},[719],{"type":19,"value":239},{"type":14,"tag":191,"props":721,"children":723},{"class":193,"line":722},22,[724,728,732,737,741,745,750],{"type":14,"tag":191,"props":725,"children":726},{"class":204},[727],{"type":19,"value":272},{"type":14,"tag":191,"props":729,"children":730},{"class":255},[731],{"type":19,"value":394},{"type":14,"tag":191,"props":733,"children":734},{"class":204},[735],{"type":19,"value":736},"::coroutine_handle",{"type":14,"tag":191,"props":738,"children":739},{"class":198},[740],{"type":19,"value":409},{"type":14,"tag":191,"props":742,"children":743},{"class":204},[744],{"type":19,"value":285},{"type":14,"tag":191,"props":746,"children":747},{"class":198},[748],{"type":19,"value":749},">",{"type":14,"tag":191,"props":751,"children":752},{"class":204},[753],{"type":19,"value":754}," coroutine;\n",{"type":14,"tag":191,"props":756,"children":758},{"class":193,"line":757},23,[759],{"type":14,"tag":191,"props":760,"children":761},{},[762],{"type":19,"value":239},{"type":14,"tag":191,"props":764,"children":766},{"class":193,"line":765},24,[767,771,775,779,783,787,791,795,799,804,809,814,819],{"type":14,"tag":191,"props":768,"children":769},{"class":204},[770],{"type":19,"value":272},{"type":14,"tag":191,"props":772,"children":773},{"class":255},[774],{"type":19,"value":258},{"type":14,"tag":191,"props":776,"children":777},{"class":204},[778],{"type":19,"value":389},{"type":14,"tag":191,"props":780,"children":781},{"class":255},[782],{"type":19,"value":394},{"type":14,"tag":191,"props":784,"children":785},{"class":204},[786],{"type":19,"value":399},{"type":14,"tag":191,"props":788,"children":789},{"class":255},[790],{"type":19,"value":404},{"type":14,"tag":191,"props":792,"children":793},{"class":204},[794],{"type":19,"value":409},{"type":14,"tag":191,"props":796,"children":797},{"class":255},[798],{"type":19,"value":285},{"type":14,"tag":191,"props":800,"children":801},{"class":204},[802],{"type":19,"value":803},"> ",{"type":14,"tag":191,"props":805,"children":806},{"class":651},[807],{"type":19,"value":808},"handle",{"type":14,"tag":191,"props":810,"children":811},{"class":204},[812],{"type":19,"value":813},") : ",{"type":14,"tag":191,"props":815,"children":816},{"class":255},[817],{"type":19,"value":818},"coroutine",{"type":14,"tag":191,"props":820,"children":821},{"class":204},[822],{"type":19,"value":823},"(handle) {}\n",{"type":14,"tag":191,"props":825,"children":827},{"class":193,"line":826},25,[828],{"type":14,"tag":191,"props":829,"children":830},{},[831],{"type":19,"value":239},{"type":14,"tag":191,"props":833,"children":835},{"class":193,"line":834},26,[836,840,845],{"type":14,"tag":191,"props":837,"children":838},{"class":204},[839],{"type":19,"value":272},{"type":14,"tag":191,"props":841,"children":842},{"class":255},[843],{"type":19,"value":844},"~CountingCoroutine",{"type":14,"tag":191,"props":846,"children":847},{"class":204},[848],{"type":19,"value":362},{"type":14,"tag":191,"props":850,"children":852},{"class":193,"line":851},27,[853,857,862],{"type":14,"tag":191,"props":854,"children":855},{"class":204},[856],{"type":19,"value":298},{"type":14,"tag":191,"props":858,"children":859},{"class":198},[860],{"type":19,"value":861},"if",{"type":14,"tag":191,"props":863,"children":864},{"class":204},[865],{"type":19,"value":866}," (coroutine)\n",{"type":14,"tag":191,"props":868,"children":870},{"class":193,"line":869},28,[871,876,881],{"type":14,"tag":191,"props":872,"children":873},{"class":204},[874],{"type":19,"value":875},"            coroutine.",{"type":14,"tag":191,"props":877,"children":878},{"class":255},[879],{"type":19,"value":880},"destroy",{"type":14,"tag":191,"props":882,"children":883},{"class":204},[884],{"type":19,"value":885},"();\n",{"type":14,"tag":191,"props":887,"children":889},{"class":193,"line":888},29,[890],{"type":14,"tag":191,"props":891,"children":892},{"class":204},[893],{"type":19,"value":894},"    }\n",{"type":14,"tag":191,"props":896,"children":898},{"class":193,"line":897},30,[899],{"type":14,"tag":191,"props":900,"children":901},{},[902],{"type":19,"value":239},{"type":14,"tag":191,"props":904,"children":906},{"class":193,"line":905},31,[907,911,915,919,924,928,933],{"type":14,"tag":191,"props":908,"children":909},{"class":204},[910],{"type":19,"value":272},{"type":14,"tag":191,"props":912,"children":913},{"class":198},[914],{"type":19,"value":303},{"type":14,"tag":191,"props":916,"children":917},{"class":204},[918],{"type":19,"value":207},{"type":14,"tag":191,"props":920,"children":921},{"class":255},[922],{"type":19,"value":923},"getValue",{"type":14,"tag":191,"props":925,"children":926},{"class":204},[927],{"type":19,"value":537},{"type":14,"tag":191,"props":929,"children":930},{"class":198},[931],{"type":19,"value":932},"const",{"type":14,"tag":191,"props":934,"children":935},{"class":204},[936],{"type":19,"value":263},{"type":14,"tag":191,"props":938,"children":940},{"class":193,"line":939},32,[941,945,949,954,959],{"type":14,"tag":191,"props":942,"children":943},{"class":204},[944],{"type":19,"value":298},{"type":14,"tag":191,"props":946,"children":947},{"class":198},[948],{"type":19,"value":376},{"type":14,"tag":191,"props":950,"children":951},{"class":204},[952],{"type":19,"value":953}," coroutine.",{"type":14,"tag":191,"props":955,"children":956},{"class":255},[957],{"type":19,"value":958},"promise",{"type":14,"tag":191,"props":960,"children":961},{"class":204},[962],{"type":19,"value":963},"().current_value;\n",{"type":14,"tag":191,"props":965,"children":967},{"class":193,"line":966},33,[968],{"type":14,"tag":191,"props":969,"children":970},{"class":204},[971],{"type":19,"value":894},{"type":14,"tag":191,"props":973,"children":975},{"class":193,"line":974},34,[976],{"type":14,"tag":191,"props":977,"children":978},{},[979],{"type":19,"value":239},{"type":14,"tag":191,"props":981,"children":983},{"class":193,"line":982},35,[984,988,992,996,1001],{"type":14,"tag":191,"props":985,"children":986},{"class":204},[987],{"type":19,"value":272},{"type":14,"tag":191,"props":989,"children":990},{"class":198},[991],{"type":19,"value":568},{"type":14,"tag":191,"props":993,"children":994},{"class":204},[995],{"type":19,"value":207},{"type":14,"tag":191,"props":997,"children":998},{"class":255},[999],{"type":19,"value":1000},"resume",{"type":14,"tag":191,"props":1002,"children":1003},{"class":204},[1004],{"type":19,"value":362},{"type":14,"tag":191,"props":1006,"children":1008},{"class":193,"line":1007},36,[1009,1014,1018],{"type":14,"tag":191,"props":1010,"children":1011},{"class":204},[1012],{"type":19,"value":1013},"        coroutine.",{"type":14,"tag":191,"props":1015,"children":1016},{"class":255},[1017],{"type":19,"value":1000},{"type":14,"tag":191,"props":1019,"children":1020},{"class":204},[1021],{"type":19,"value":885},{"type":14,"tag":191,"props":1023,"children":1025},{"class":193,"line":1024},37,[1026],{"type":14,"tag":191,"props":1027,"children":1028},{"class":204},[1029],{"type":19,"value":894},{"type":14,"tag":191,"props":1031,"children":1033},{"class":193,"line":1032},38,[1034],{"type":14,"tag":191,"props":1035,"children":1036},{"class":204},[1037],{"type":19,"value":1038},"};\n",{"type":14,"tag":191,"props":1040,"children":1042},{"class":193,"line":1041},39,[1043],{"type":14,"tag":191,"props":1044,"children":1045},{},[1046],{"type":19,"value":239},{"type":14,"tag":191,"props":1048,"children":1050},{"class":193,"line":1049},40,[1051,1055,1059,1064],{"type":14,"tag":191,"props":1052,"children":1053},{"class":255},[1054],{"type":19,"value":258},{"type":14,"tag":191,"props":1056,"children":1057},{"class":204},[1058],{"type":19,"value":207},{"type":14,"tag":191,"props":1060,"children":1061},{"class":255},[1062],{"type":19,"value":1063},"generateNumbers",{"type":14,"tag":191,"props":1065,"children":1066},{"class":204},[1067],{"type":19,"value":362},{"type":14,"tag":191,"props":1069,"children":1071},{"class":193,"line":1070},41,[1072,1076,1081,1086,1090,1095,1099,1103,1107,1112,1116,1120,1125,1130,1135],{"type":14,"tag":191,"props":1073,"children":1074},{"class":204},[1075],{"type":19,"value":272},{"type":14,"tag":191,"props":1077,"children":1078},{"class":198},[1079],{"type":19,"value":1080},"for",{"type":14,"tag":191,"props":1082,"children":1083},{"class":204},[1084],{"type":19,"value":1085}," (",{"type":14,"tag":191,"props":1087,"children":1088},{"class":198},[1089],{"type":19,"value":303},{"type":14,"tag":191,"props":1091,"children":1092},{"class":204},[1093],{"type":19,"value":1094}," i ",{"type":14,"tag":191,"props":1096,"children":1097},{"class":198},[1098],{"type":19,"value":313},{"type":14,"tag":191,"props":1100,"children":1101},{"class":204},[1102],{"type":19,"value":207},{"type":14,"tag":191,"props":1104,"children":1105},{"class":320},[1106],{"type":19,"value":323},{"type":14,"tag":191,"props":1108,"children":1109},{"class":204},[1110],{"type":19,"value":1111},"; i ",{"type":14,"tag":191,"props":1113,"children":1114},{"class":198},[1115],{"type":19,"value":409},{"type":14,"tag":191,"props":1117,"children":1118},{"class":204},[1119],{"type":19,"value":207},{"type":14,"tag":191,"props":1121,"children":1122},{"class":320},[1123],{"type":19,"value":1124},"10",{"type":14,"tag":191,"props":1126,"children":1127},{"class":204},[1128],{"type":19,"value":1129},"; ",{"type":14,"tag":191,"props":1131,"children":1132},{"class":198},[1133],{"type":19,"value":1134},"++",{"type":14,"tag":191,"props":1136,"children":1137},{"class":204},[1138],{"type":19,"value":1139},"i) {\n",{"type":14,"tag":191,"props":1141,"children":1143},{"class":193,"line":1142},42,[1144],{"type":14,"tag":191,"props":1145,"children":1147},{"class":1146},"ct-782603",[1148],{"type":19,"value":1149},"        //移交控制权\n",{"type":14,"tag":191,"props":1151,"children":1153},{"class":193,"line":1152},43,[1154,1158,1163],{"type":14,"tag":191,"props":1155,"children":1156},{"class":204},[1157],{"type":19,"value":298},{"type":14,"tag":191,"props":1159,"children":1160},{"class":198},[1161],{"type":19,"value":1162},"co_yield",{"type":14,"tag":191,"props":1164,"children":1165},{"class":204},[1166],{"type":19,"value":1167}," i;\n",{"type":14,"tag":191,"props":1169,"children":1171},{"class":193,"line":1170},44,[1172],{"type":14,"tag":191,"props":1173,"children":1174},{"class":204},[1175],{"type":19,"value":894},{"type":14,"tag":191,"props":1177,"children":1179},{"class":193,"line":1178},45,[1180],{"type":14,"tag":191,"props":1181,"children":1182},{"class":204},[1183],{"type":19,"value":1184},"}\n",{"type":14,"tag":191,"props":1186,"children":1188},{"class":193,"line":1187},46,[1189],{"type":14,"tag":191,"props":1190,"children":1191},{},[1192],{"type":19,"value":239},{"type":14,"tag":191,"props":1194,"children":1196},{"class":193,"line":1195},47,[1197,1201,1205,1210],{"type":14,"tag":191,"props":1198,"children":1199},{"class":198},[1200],{"type":19,"value":303},{"type":14,"tag":191,"props":1202,"children":1203},{"class":204},[1204],{"type":19,"value":207},{"type":14,"tag":191,"props":1206,"children":1207},{"class":255},[1208],{"type":19,"value":1209},"main",{"type":14,"tag":191,"props":1211,"children":1212},{"class":204},[1213],{"type":19,"value":362},{"type":14,"tag":191,"props":1215,"children":1217},{"class":193,"line":1216},48,[1218,1223,1227,1231,1235],{"type":14,"tag":191,"props":1219,"children":1220},{"class":204},[1221],{"type":19,"value":1222},"    CountingCoroutine counter ",{"type":14,"tag":191,"props":1224,"children":1225},{"class":198},[1226],{"type":19,"value":313},{"type":14,"tag":191,"props":1228,"children":1229},{"class":204},[1230],{"type":19,"value":207},{"type":14,"tag":191,"props":1232,"children":1233},{"class":255},[1234],{"type":19,"value":1063},{"type":14,"tag":191,"props":1236,"children":1237},{"class":204},[1238],{"type":19,"value":885},{"type":14,"tag":191,"props":1240,"children":1242},{"class":193,"line":1241},49,[1243],{"type":14,"tag":191,"props":1244,"children":1245},{},[1246],{"type":19,"value":239},{"type":14,"tag":191,"props":1248,"children":1250},{"class":193,"line":1249},50,[1251,1255,1260],{"type":14,"tag":191,"props":1252,"children":1253},{"class":204},[1254],{"type":19,"value":272},{"type":14,"tag":191,"props":1256,"children":1257},{"class":198},[1258],{"type":19,"value":1259},"while",{"type":14,"tag":191,"props":1261,"children":1262},{"class":204},[1263],{"type":19,"value":1264}," (counter.coroutine) {\n",{"type":14,"tag":191,"props":1266,"children":1268},{"class":193,"line":1267},51,[1269,1273,1277,1282,1287,1291,1296,1300,1304,1309,1313,1317,1321,1325,1329],{"type":14,"tag":191,"props":1270,"children":1271},{"class":204},[1272],{"type":19,"value":298},{"type":14,"tag":191,"props":1274,"children":1275},{"class":255},[1276],{"type":19,"value":394},{"type":14,"tag":191,"props":1278,"children":1279},{"class":204},[1280],{"type":19,"value":1281},"::cout ",{"type":14,"tag":191,"props":1283,"children":1284},{"class":198},[1285],{"type":19,"value":1286},"\u003C\u003C",{"type":14,"tag":191,"props":1288,"children":1289},{"class":204},[1290],{"type":19,"value":207},{"type":14,"tag":191,"props":1292,"children":1293},{"class":210},[1294],{"type":19,"value":1295},"\"Value: \"",{"type":14,"tag":191,"props":1297,"children":1298},{"class":204},[1299],{"type":19,"value":207},{"type":14,"tag":191,"props":1301,"children":1302},{"class":198},[1303],{"type":19,"value":1286},{"type":14,"tag":191,"props":1305,"children":1306},{"class":204},[1307],{"type":19,"value":1308}," counter.",{"type":14,"tag":191,"props":1310,"children":1311},{"class":255},[1312],{"type":19,"value":923},{"type":14,"tag":191,"props":1314,"children":1315},{"class":204},[1316],{"type":19,"value":537},{"type":14,"tag":191,"props":1318,"children":1319},{"class":198},[1320],{"type":19,"value":1286},{"type":14,"tag":191,"props":1322,"children":1323},{"class":204},[1324],{"type":19,"value":207},{"type":14,"tag":191,"props":1326,"children":1327},{"class":255},[1328],{"type":19,"value":394},{"type":14,"tag":191,"props":1330,"children":1331},{"class":204},[1332],{"type":19,"value":1333},"::endl;\n",{"type":14,"tag":191,"props":1335,"children":1337},{"class":193,"line":1336},52,[1338],{"type":14,"tag":191,"props":1339,"children":1340},{"class":1146},[1341],{"type":19,"value":1342},"        //回到 co_yield 继续执行\n",{"type":14,"tag":191,"props":1344,"children":1346},{"class":193,"line":1345},53,[1347,1352,1356],{"type":14,"tag":191,"props":1348,"children":1349},{"class":204},[1350],{"type":19,"value":1351},"        counter.",{"type":14,"tag":191,"props":1353,"children":1354},{"class":255},[1355],{"type":19,"value":1000},{"type":14,"tag":191,"props":1357,"children":1358},{"class":204},[1359],{"type":19,"value":885},{"type":14,"tag":191,"props":1361,"children":1363},{"class":193,"line":1362},54,[1364],{"type":14,"tag":191,"props":1365,"children":1366},{"class":204},[1367],{"type":19,"value":894},{"type":14,"tag":191,"props":1369,"children":1371},{"class":193,"line":1370},55,[1372],{"type":14,"tag":191,"props":1373,"children":1374},{},[1375],{"type":19,"value":239},{"type":14,"tag":191,"props":1377,"children":1379},{"class":193,"line":1378},56,[1380,1384,1388,1392,1396],{"type":14,"tag":191,"props":1381,"children":1382},{"class":204},[1383],{"type":19,"value":272},{"type":14,"tag":191,"props":1385,"children":1386},{"class":198},[1387],{"type":19,"value":376},{"type":14,"tag":191,"props":1389,"children":1390},{"class":204},[1391],{"type":19,"value":207},{"type":14,"tag":191,"props":1393,"children":1394},{"class":320},[1395],{"type":19,"value":323},{"type":14,"tag":191,"props":1397,"children":1398},{"class":204},[1399],{"type":19,"value":328},{"type":14,"tag":191,"props":1401,"children":1403},{"class":193,"line":1402},57,[1404],{"type":14,"tag":191,"props":1405,"children":1406},{"class":204},[1407],{"type":19,"value":1408},"}",{"type":14,"tag":15,"props":1410,"children":1411},{},[1412],{"type":19,"value":1413},"在 Go 语言中, 我们可以通过 chan 在没有特定从属关系的情况下完成协程间控制权的转移, 也算是对称协程的实现:",{"type":14,"tag":176,"props":1415,"children":1420},{"className":1416,"code":1418,"language":1419,"meta":5},[1417],"language-go","func main() {\n    ch1 := make(chan int)\n    ch2 := make(chan int)\n\n    var wg sync.WaitGroup\n\n    wg.Add(1)\n    go func() { // \u003C--- 1\n        defer wg.Done()\n        for val := range ch1 {\n            fmt.Println(val)\n        }\n    }()\n\n    wg.Add(1)\n    go func() { // \u003C--- 2\n        defer wg.Done()\n        for val := range ch2 {\n            ch1 \u003C- val\n        }\n        close(ch1)\n    }()\n\n    wg.Add(1)\n    go func() { // \u003C--- 3\n        defer wg.Done()\n        for i := 1; i \u003C= 5; i++ {\n            ch2 \u003C- i\n        }\n        close(ch2)\n    }()\n\n    wg.Wait()\n}\n","go",[1421],{"type":14,"tag":184,"props":1422,"children":1423},{},[1424],{"type":14,"tag":176,"props":1425,"children":1426},{"__ignoreMap":5},[1427,1447,1491,1531,1538,1555,1562,1588,1616,1643,1677,1695,1702,1710,1717,1740,1768,1791,1823,1841,1848,1865,1872,1879,1902,1930,1953,2011,2028,2035,2051,2058,2065,2081],{"type":14,"tag":191,"props":1428,"children":1429},{"class":193,"line":194},[1430,1435,1439,1443],{"type":14,"tag":191,"props":1431,"children":1432},{"class":198},[1433],{"type":19,"value":1434},"func",{"type":14,"tag":191,"props":1436,"children":1437},{"class":204},[1438],{"type":19,"value":207},{"type":14,"tag":191,"props":1440,"children":1441},{"class":255},[1442],{"type":19,"value":1209},{"type":14,"tag":191,"props":1444,"children":1445},{"class":204},[1446],{"type":19,"value":362},{"type":14,"tag":191,"props":1448,"children":1449},{"class":193,"line":216},[1450,1455,1460,1464,1469,1473,1478,1482,1486],{"type":14,"tag":191,"props":1451,"children":1452},{"class":204},[1453],{"type":19,"value":1454},"    ch1 ",{"type":14,"tag":191,"props":1456,"children":1457},{"class":198},[1458],{"type":19,"value":1459},":=",{"type":14,"tag":191,"props":1461,"children":1462},{"class":204},[1463],{"type":19,"value":207},{"type":14,"tag":191,"props":1465,"children":1466},{"class":320},[1467],{"type":19,"value":1468},"make",{"type":14,"tag":191,"props":1470,"children":1471},{"class":204},[1472],{"type":19,"value":389},{"type":14,"tag":191,"props":1474,"children":1475},{"class":198},[1476],{"type":19,"value":1477},"chan",{"type":14,"tag":191,"props":1479,"children":1480},{"class":204},[1481],{"type":19,"value":207},{"type":14,"tag":191,"props":1483,"children":1484},{"class":198},[1485],{"type":19,"value":303},{"type":14,"tag":191,"props":1487,"children":1488},{"class":204},[1489],{"type":19,"value":1490},")\n",{"type":14,"tag":191,"props":1492,"children":1493},{"class":193,"line":233},[1494,1499,1503,1507,1511,1515,1519,1523,1527],{"type":14,"tag":191,"props":1495,"children":1496},{"class":204},[1497],{"type":19,"value":1498},"    ch2 ",{"type":14,"tag":191,"props":1500,"children":1501},{"class":198},[1502],{"type":19,"value":1459},{"type":14,"tag":191,"props":1504,"children":1505},{"class":204},[1506],{"type":19,"value":207},{"type":14,"tag":191,"props":1508,"children":1509},{"class":320},[1510],{"type":19,"value":1468},{"type":14,"tag":191,"props":1512,"children":1513},{"class":204},[1514],{"type":19,"value":389},{"type":14,"tag":191,"props":1516,"children":1517},{"class":198},[1518],{"type":19,"value":1477},{"type":14,"tag":191,"props":1520,"children":1521},{"class":204},[1522],{"type":19,"value":207},{"type":14,"tag":191,"props":1524,"children":1525},{"class":198},[1526],{"type":19,"value":303},{"type":14,"tag":191,"props":1528,"children":1529},{"class":204},[1530],{"type":19,"value":1490},{"type":14,"tag":191,"props":1532,"children":1533},{"class":193,"line":242},[1534],{"type":14,"tag":191,"props":1535,"children":1536},{},[1537],{"type":19,"value":239},{"type":14,"tag":191,"props":1539,"children":1540},{"class":193,"line":266},[1541,1545,1550],{"type":14,"tag":191,"props":1542,"children":1543},{"class":204},[1544],{"type":19,"value":272},{"type":14,"tag":191,"props":1546,"children":1547},{"class":198},[1548],{"type":19,"value":1549},"var",{"type":14,"tag":191,"props":1551,"children":1552},{"class":204},[1553],{"type":19,"value":1554}," wg sync.WaitGroup\n",{"type":14,"tag":191,"props":1556,"children":1557},{"class":193,"line":292},[1558],{"type":14,"tag":191,"props":1559,"children":1560},{},[1561],{"type":19,"value":239},{"type":14,"tag":191,"props":1563,"children":1564},{"class":193,"line":331},[1565,1570,1575,1579,1584],{"type":14,"tag":191,"props":1566,"children":1567},{"class":204},[1568],{"type":19,"value":1569},"    wg.",{"type":14,"tag":191,"props":1571,"children":1572},{"class":320},[1573],{"type":19,"value":1574},"Add",{"type":14,"tag":191,"props":1576,"children":1577},{"class":204},[1578],{"type":19,"value":389},{"type":14,"tag":191,"props":1580,"children":1581},{"class":320},[1582],{"type":19,"value":1583},"1",{"type":14,"tag":191,"props":1585,"children":1586},{"class":204},[1587],{"type":19,"value":1490},{"type":14,"tag":191,"props":1589,"children":1590},{"class":193,"line":339},[1591,1595,1599,1603,1607,1611],{"type":14,"tag":191,"props":1592,"children":1593},{"class":204},[1594],{"type":19,"value":272},{"type":14,"tag":191,"props":1596,"children":1597},{"class":198},[1598],{"type":19,"value":1419},{"type":14,"tag":191,"props":1600,"children":1601},{"class":204},[1602],{"type":19,"value":207},{"type":14,"tag":191,"props":1604,"children":1605},{"class":198},[1606],{"type":19,"value":1434},{"type":14,"tag":191,"props":1608,"children":1609},{"class":204},[1610],{"type":19,"value":494},{"type":14,"tag":191,"props":1612,"children":1613},{"class":1146},[1614],{"type":19,"value":1615},"// \u003C--- 1\n",{"type":14,"tag":191,"props":1617,"children":1618},{"class":193,"line":365},[1619,1623,1628,1633,1638],{"type":14,"tag":191,"props":1620,"children":1621},{"class":204},[1622],{"type":19,"value":298},{"type":14,"tag":191,"props":1624,"children":1625},{"class":198},[1626],{"type":19,"value":1627},"defer",{"type":14,"tag":191,"props":1629,"children":1630},{"class":204},[1631],{"type":19,"value":1632}," wg.",{"type":14,"tag":191,"props":1634,"children":1635},{"class":320},[1636],{"type":19,"value":1637},"Done",{"type":14,"tag":191,"props":1639,"children":1640},{"class":204},[1641],{"type":19,"value":1642},"()\n",{"type":14,"tag":191,"props":1644,"children":1645},{"class":193,"line":445},[1646,1650,1654,1659,1663,1667,1672],{"type":14,"tag":191,"props":1647,"children":1648},{"class":204},[1649],{"type":19,"value":298},{"type":14,"tag":191,"props":1651,"children":1652},{"class":198},[1653],{"type":19,"value":1080},{"type":14,"tag":191,"props":1655,"children":1656},{"class":204},[1657],{"type":19,"value":1658}," val ",{"type":14,"tag":191,"props":1660,"children":1661},{"class":198},[1662],{"type":19,"value":1459},{"type":14,"tag":191,"props":1664,"children":1665},{"class":204},[1666],{"type":19,"value":207},{"type":14,"tag":191,"props":1668,"children":1669},{"class":198},[1670],{"type":19,"value":1671},"range",{"type":14,"tag":191,"props":1673,"children":1674},{"class":204},[1675],{"type":19,"value":1676}," ch1 {\n",{"type":14,"tag":191,"props":1678,"children":1679},{"class":193,"line":454},[1680,1685,1690],{"type":14,"tag":191,"props":1681,"children":1682},{"class":204},[1683],{"type":19,"value":1684},"            fmt.",{"type":14,"tag":191,"props":1686,"children":1687},{"class":320},[1688],{"type":19,"value":1689},"Println",{"type":14,"tag":191,"props":1691,"children":1692},{"class":204},[1693],{"type":19,"value":1694},"(val)\n",{"type":14,"tag":191,"props":1696,"children":1697},{"class":193,"line":462},[1698],{"type":14,"tag":191,"props":1699,"children":1700},{"class":204},[1701],{"type":19,"value":451},{"type":14,"tag":191,"props":1703,"children":1704},{"class":193,"line":506},[1705],{"type":14,"tag":191,"props":1706,"children":1707},{"class":204},[1708],{"type":19,"value":1709},"    }()\n",{"type":14,"tag":191,"props":1711,"children":1712},{"class":193,"line":558},[1713],{"type":14,"tag":191,"props":1714,"children":1715},{},[1716],{"type":19,"value":239},{"type":14,"tag":191,"props":1718,"children":1719},{"class":193,"line":585},[1720,1724,1728,1732,1736],{"type":14,"tag":191,"props":1721,"children":1722},{"class":204},[1723],{"type":19,"value":1569},{"type":14,"tag":191,"props":1725,"children":1726},{"class":320},[1727],{"type":19,"value":1574},{"type":14,"tag":191,"props":1729,"children":1730},{"class":204},[1731],{"type":19,"value":389},{"type":14,"tag":191,"props":1733,"children":1734},{"class":320},[1735],{"type":19,"value":1583},{"type":14,"tag":191,"props":1737,"children":1738},{"class":204},[1739],{"type":19,"value":1490},{"type":14,"tag":191,"props":1741,"children":1742},{"class":193,"line":610},[1743,1747,1751,1755,1759,1763],{"type":14,"tag":191,"props":1744,"children":1745},{"class":204},[1746],{"type":19,"value":272},{"type":14,"tag":191,"props":1748,"children":1749},{"class":198},[1750],{"type":19,"value":1419},{"type":14,"tag":191,"props":1752,"children":1753},{"class":204},[1754],{"type":19,"value":207},{"type":14,"tag":191,"props":1756,"children":1757},{"class":198},[1758],{"type":19,"value":1434},{"type":14,"tag":191,"props":1760,"children":1761},{"class":204},[1762],{"type":19,"value":494},{"type":14,"tag":191,"props":1764,"children":1765},{"class":1146},[1766],{"type":19,"value":1767},"// \u003C--- 2\n",{"type":14,"tag":191,"props":1769,"children":1770},{"class":193,"line":662},[1771,1775,1779,1783,1787],{"type":14,"tag":191,"props":1772,"children":1773},{"class":204},[1774],{"type":19,"value":298},{"type":14,"tag":191,"props":1776,"children":1777},{"class":198},[1778],{"type":19,"value":1627},{"type":14,"tag":191,"props":1780,"children":1781},{"class":204},[1782],{"type":19,"value":1632},{"type":14,"tag":191,"props":1784,"children":1785},{"class":320},[1786],{"type":19,"value":1637},{"type":14,"tag":191,"props":1788,"children":1789},{"class":204},[1790],{"type":19,"value":1642},{"type":14,"tag":191,"props":1792,"children":1793},{"class":193,"line":680},[1794,1798,1802,1806,1810,1814,1818],{"type":14,"tag":191,"props":1795,"children":1796},{"class":204},[1797],{"type":19,"value":298},{"type":14,"tag":191,"props":1799,"children":1800},{"class":198},[1801],{"type":19,"value":1080},{"type":14,"tag":191,"props":1803,"children":1804},{"class":204},[1805],{"type":19,"value":1658},{"type":14,"tag":191,"props":1807,"children":1808},{"class":198},[1809],{"type":19,"value":1459},{"type":14,"tag":191,"props":1811,"children":1812},{"class":204},[1813],{"type":19,"value":207},{"type":14,"tag":191,"props":1815,"children":1816},{"class":198},[1817],{"type":19,"value":1671},{"type":14,"tag":191,"props":1819,"children":1820},{"class":204},[1821],{"type":19,"value":1822}," ch2 {\n",{"type":14,"tag":191,"props":1824,"children":1825},{"class":193,"line":697},[1826,1831,1836],{"type":14,"tag":191,"props":1827,"children":1828},{"class":204},[1829],{"type":19,"value":1830},"            ch1 ",{"type":14,"tag":191,"props":1832,"children":1833},{"class":198},[1834],{"type":19,"value":1835},"\u003C-",{"type":14,"tag":191,"props":1837,"children":1838},{"class":204},[1839],{"type":19,"value":1840}," val\n",{"type":14,"tag":191,"props":1842,"children":1843},{"class":193,"line":705},[1844],{"type":14,"tag":191,"props":1845,"children":1846},{"class":204},[1847],{"type":19,"value":451},{"type":14,"tag":191,"props":1849,"children":1850},{"class":193,"line":714},[1851,1855,1860],{"type":14,"tag":191,"props":1852,"children":1853},{"class":204},[1854],{"type":19,"value":298},{"type":14,"tag":191,"props":1856,"children":1857},{"class":320},[1858],{"type":19,"value":1859},"close",{"type":14,"tag":191,"props":1861,"children":1862},{"class":204},[1863],{"type":19,"value":1864},"(ch1)\n",{"type":14,"tag":191,"props":1866,"children":1867},{"class":193,"line":722},[1868],{"type":14,"tag":191,"props":1869,"children":1870},{"class":204},[1871],{"type":19,"value":1709},{"type":14,"tag":191,"props":1873,"children":1874},{"class":193,"line":757},[1875],{"type":14,"tag":191,"props":1876,"children":1877},{},[1878],{"type":19,"value":239},{"type":14,"tag":191,"props":1880,"children":1881},{"class":193,"line":765},[1882,1886,1890,1894,1898],{"type":14,"tag":191,"props":1883,"children":1884},{"class":204},[1885],{"type":19,"value":1569},{"type":14,"tag":191,"props":1887,"children":1888},{"class":320},[1889],{"type":19,"value":1574},{"type":14,"tag":191,"props":1891,"children":1892},{"class":204},[1893],{"type":19,"value":389},{"type":14,"tag":191,"props":1895,"children":1896},{"class":320},[1897],{"type":19,"value":1583},{"type":14,"tag":191,"props":1899,"children":1900},{"class":204},[1901],{"type":19,"value":1490},{"type":14,"tag":191,"props":1903,"children":1904},{"class":193,"line":826},[1905,1909,1913,1917,1921,1925],{"type":14,"tag":191,"props":1906,"children":1907},{"class":204},[1908],{"type":19,"value":272},{"type":14,"tag":191,"props":1910,"children":1911},{"class":198},[1912],{"type":19,"value":1419},{"type":14,"tag":191,"props":1914,"children":1915},{"class":204},[1916],{"type":19,"value":207},{"type":14,"tag":191,"props":1918,"children":1919},{"class":198},[1920],{"type":19,"value":1434},{"type":14,"tag":191,"props":1922,"children":1923},{"class":204},[1924],{"type":19,"value":494},{"type":14,"tag":191,"props":1926,"children":1927},{"class":1146},[1928],{"type":19,"value":1929},"// \u003C--- 3\n",{"type":14,"tag":191,"props":1931,"children":1932},{"class":193,"line":834},[1933,1937,1941,1945,1949],{"type":14,"tag":191,"props":1934,"children":1935},{"class":204},[1936],{"type":19,"value":298},{"type":14,"tag":191,"props":1938,"children":1939},{"class":198},[1940],{"type":19,"value":1627},{"type":14,"tag":191,"props":1942,"children":1943},{"class":204},[1944],{"type":19,"value":1632},{"type":14,"tag":191,"props":1946,"children":1947},{"class":320},[1948],{"type":19,"value":1637},{"type":14,"tag":191,"props":1950,"children":1951},{"class":204},[1952],{"type":19,"value":1642},{"type":14,"tag":191,"props":1954,"children":1955},{"class":193,"line":851},[1956,1960,1964,1968,1972,1976,1980,1984,1989,1993,1998,2003,2007],{"type":14,"tag":191,"props":1957,"children":1958},{"class":204},[1959],{"type":19,"value":298},{"type":14,"tag":191,"props":1961,"children":1962},{"class":198},[1963],{"type":19,"value":1080},{"type":14,"tag":191,"props":1965,"children":1966},{"class":204},[1967],{"type":19,"value":1094},{"type":14,"tag":191,"props":1969,"children":1970},{"class":198},[1971],{"type":19,"value":1459},{"type":14,"tag":191,"props":1973,"children":1974},{"class":204},[1975],{"type":19,"value":207},{"type":14,"tag":191,"props":1977,"children":1978},{"class":320},[1979],{"type":19,"value":1583},{"type":14,"tag":191,"props":1981,"children":1982},{"class":204},[1983],{"type":19,"value":1111},{"type":14,"tag":191,"props":1985,"children":1986},{"class":198},[1987],{"type":19,"value":1988},"\u003C=",{"type":14,"tag":191,"props":1990,"children":1991},{"class":204},[1992],{"type":19,"value":207},{"type":14,"tag":191,"props":1994,"children":1995},{"class":320},[1996],{"type":19,"value":1997},"5",{"type":14,"tag":191,"props":1999,"children":2000},{"class":204},[2001],{"type":19,"value":2002},"; i",{"type":14,"tag":191,"props":2004,"children":2005},{"class":198},[2006],{"type":19,"value":1134},{"type":14,"tag":191,"props":2008,"children":2009},{"class":204},[2010],{"type":19,"value":263},{"type":14,"tag":191,"props":2012,"children":2013},{"class":193,"line":869},[2014,2019,2023],{"type":14,"tag":191,"props":2015,"children":2016},{"class":204},[2017],{"type":19,"value":2018},"            ch2 ",{"type":14,"tag":191,"props":2020,"children":2021},{"class":198},[2022],{"type":19,"value":1835},{"type":14,"tag":191,"props":2024,"children":2025},{"class":204},[2026],{"type":19,"value":2027}," i\n",{"type":14,"tag":191,"props":2029,"children":2030},{"class":193,"line":888},[2031],{"type":14,"tag":191,"props":2032,"children":2033},{"class":204},[2034],{"type":19,"value":451},{"type":14,"tag":191,"props":2036,"children":2037},{"class":193,"line":897},[2038,2042,2046],{"type":14,"tag":191,"props":2039,"children":2040},{"class":204},[2041],{"type":19,"value":298},{"type":14,"tag":191,"props":2043,"children":2044},{"class":320},[2045],{"type":19,"value":1859},{"type":14,"tag":191,"props":2047,"children":2048},{"class":204},[2049],{"type":19,"value":2050},"(ch2)\n",{"type":14,"tag":191,"props":2052,"children":2053},{"class":193,"line":905},[2054],{"type":14,"tag":191,"props":2055,"children":2056},{"class":204},[2057],{"type":19,"value":1709},{"type":14,"tag":191,"props":2059,"children":2060},{"class":193,"line":939},[2061],{"type":14,"tag":191,"props":2062,"children":2063},{},[2064],{"type":19,"value":239},{"type":14,"tag":191,"props":2066,"children":2067},{"class":193,"line":966},[2068,2072,2077],{"type":14,"tag":191,"props":2069,"children":2070},{"class":204},[2071],{"type":19,"value":1569},{"type":14,"tag":191,"props":2073,"children":2074},{"class":320},[2075],{"type":19,"value":2076},"Wait",{"type":14,"tag":191,"props":2078,"children":2079},{"class":204},[2080],{"type":19,"value":1642},{"type":14,"tag":191,"props":2082,"children":2083},{"class":193,"line":974},[2084],{"type":14,"tag":191,"props":2085,"children":2086},{"class":204},[2087],{"type":19,"value":1408},{"type":14,"tag":15,"props":2089,"children":2090},{},[2091],{"type":19,"value":2092},"如果按照代码的顺序执行, 那正确的排列顺序是 3 2 1, 但在此处由于channel的阻塞特性, 第一个goroutine会等待第二个goroutine将数据从 ch2 传输到 ch1, 而第二个goroutine会等待第三个goroutine将数据发送到 ch2, 这就保证了它们的执行顺序. 最后，当所有goroutine都完成并且WaitGroup计数为0时, wg.Wait() 返回, 程序退出.",{"type":14,"tag":158,"props":2094,"children":2096},{"id":2095},"非对称",[2097],{"type":19,"value":2095},{"type":14,"tag":15,"props":2099,"children":2100},{},[2101],{"type":19,"value":2102},"JavaScript 的 async、await、promise 则是创建非对称协程的工具.",{"type":14,"tag":176,"props":2104,"children":2109},{"className":2105,"code":2107,"language":2108,"meta":5},[2106],"language-javascript","// async 标记的函数会创建协程\nconst useFetch = async () => { \n  // 执行到 await 处会将该协程挂起, 直到 fetch 返回\n  const res = await fetch('https://www.v2ex.com/api/topics/hot.json')\n  return res.json()\n}\n\nconst main = () => {\n  console.log('main start')\n  // 执行到此处, 控制权转移到协程\n  useFetch().then(res => { \n    // 执行到函数内部 await 处, 暂时挂起, 控制权返回到 main\n    console.log(`fetch res: ${res}`)\n  })\n  console.log('main end')\n}\n\nmain()\n/**\n * main start\n * main end\n * fetch res: ...\n */\n","javascript",[2110],{"type":14,"tag":184,"props":2111,"children":2112},{},[2113],{"type":14,"tag":176,"props":2114,"children":2115},{"__ignoreMap":5},[2116,2124,2172,2185,2244,2269,2276,2283,2318,2344,2356,2397,2409,2443,2451,2475,2482,2489,2500,2508,2516,2524,2532],{"type":14,"tag":191,"props":2117,"children":2118},{"class":193,"line":194},[2119],{"type":14,"tag":191,"props":2120,"children":2121},{"class":1146},[2122],{"type":19,"value":2123},"// async 标记的函数会创建协程\n",{"type":14,"tag":191,"props":2125,"children":2126},{"class":193,"line":216},[2127,2131,2135,2140,2144,2148,2152,2157,2162,2167],{"type":14,"tag":191,"props":2128,"children":2129},{"class":198},[2130],{"type":19,"value":932},{"type":14,"tag":191,"props":2132,"children":2133},{"class":204},[2134],{"type":19,"value":207},{"type":14,"tag":191,"props":2136,"children":2137},{"class":255},[2138],{"type":19,"value":2139},"useFetch",{"type":14,"tag":191,"props":2141,"children":2142},{"class":204},[2143],{"type":19,"value":207},{"type":14,"tag":191,"props":2145,"children":2146},{"class":198},[2147],{"type":19,"value":313},{"type":14,"tag":191,"props":2149,"children":2150},{"class":204},[2151],{"type":19,"value":207},{"type":14,"tag":191,"props":2153,"children":2154},{"class":198},[2155],{"type":19,"value":2156},"async",{"type":14,"tag":191,"props":2158,"children":2159},{"class":204},[2160],{"type":19,"value":2161}," () ",{"type":14,"tag":191,"props":2163,"children":2164},{"class":198},[2165],{"type":19,"value":2166},"=>",{"type":14,"tag":191,"props":2168,"children":2169},{"class":204},[2170],{"type":19,"value":2171}," { \n",{"type":14,"tag":191,"props":2173,"children":2174},{"class":193,"line":233},[2175,2180],{"type":14,"tag":191,"props":2176,"children":2177},{"class":204},[2178],{"type":19,"value":2179},"  ",{"type":14,"tag":191,"props":2181,"children":2182},{"class":1146},[2183],{"type":19,"value":2184},"// 执行到 await 处会将该协程挂起, 直到 fetch 返回\n",{"type":14,"tag":191,"props":2186,"children":2187},{"class":193,"line":242},[2188,2192,2196,2200,2205,2209,2213,2217,2222,2226,2231,2235,2240],{"type":14,"tag":191,"props":2189,"children":2190},{"class":204},[2191],{"type":19,"value":2179},{"type":14,"tag":191,"props":2193,"children":2194},{"class":198},[2195],{"type":19,"value":932},{"type":14,"tag":191,"props":2197,"children":2198},{"class":204},[2199],{"type":19,"value":207},{"type":14,"tag":191,"props":2201,"children":2202},{"class":320},[2203],{"type":19,"value":2204},"res",{"type":14,"tag":191,"props":2206,"children":2207},{"class":204},[2208],{"type":19,"value":207},{"type":14,"tag":191,"props":2210,"children":2211},{"class":198},[2212],{"type":19,"value":313},{"type":14,"tag":191,"props":2214,"children":2215},{"class":204},[2216],{"type":19,"value":207},{"type":14,"tag":191,"props":2218,"children":2219},{"class":198},[2220],{"type":19,"value":2221},"await",{"type":14,"tag":191,"props":2223,"children":2224},{"class":204},[2225],{"type":19,"value":207},{"type":14,"tag":191,"props":2227,"children":2228},{"class":255},[2229],{"type":19,"value":2230},"fetch",{"type":14,"tag":191,"props":2232,"children":2233},{"class":204},[2234],{"type":19,"value":389},{"type":14,"tag":191,"props":2236,"children":2237},{"class":210},[2238],{"type":19,"value":2239},"'https://www.v2ex.com/api/topics/hot.json'",{"type":14,"tag":191,"props":2241,"children":2242},{"class":204},[2243],{"type":19,"value":1490},{"type":14,"tag":191,"props":2245,"children":2246},{"class":193,"line":266},[2247,2251,2255,2260,2265],{"type":14,"tag":191,"props":2248,"children":2249},{"class":204},[2250],{"type":19,"value":2179},{"type":14,"tag":191,"props":2252,"children":2253},{"class":198},[2254],{"type":19,"value":376},{"type":14,"tag":191,"props":2256,"children":2257},{"class":204},[2258],{"type":19,"value":2259}," res.",{"type":14,"tag":191,"props":2261,"children":2262},{"class":255},[2263],{"type":19,"value":2264},"json",{"type":14,"tag":191,"props":2266,"children":2267},{"class":204},[2268],{"type":19,"value":1642},{"type":14,"tag":191,"props":2270,"children":2271},{"class":193,"line":292},[2272],{"type":14,"tag":191,"props":2273,"children":2274},{"class":204},[2275],{"type":19,"value":1184},{"type":14,"tag":191,"props":2277,"children":2278},{"class":193,"line":331},[2279],{"type":14,"tag":191,"props":2280,"children":2281},{},[2282],{"type":19,"value":239},{"type":14,"tag":191,"props":2284,"children":2285},{"class":193,"line":339},[2286,2290,2294,2298,2302,2306,2310,2314],{"type":14,"tag":191,"props":2287,"children":2288},{"class":198},[2289],{"type":19,"value":932},{"type":14,"tag":191,"props":2291,"children":2292},{"class":204},[2293],{"type":19,"value":207},{"type":14,"tag":191,"props":2295,"children":2296},{"class":255},[2297],{"type":19,"value":1209},{"type":14,"tag":191,"props":2299,"children":2300},{"class":204},[2301],{"type":19,"value":207},{"type":14,"tag":191,"props":2303,"children":2304},{"class":198},[2305],{"type":19,"value":313},{"type":14,"tag":191,"props":2307,"children":2308},{"class":204},[2309],{"type":19,"value":2161},{"type":14,"tag":191,"props":2311,"children":2312},{"class":198},[2313],{"type":19,"value":2166},{"type":14,"tag":191,"props":2315,"children":2316},{"class":204},[2317],{"type":19,"value":263},{"type":14,"tag":191,"props":2319,"children":2320},{"class":193,"line":365},[2321,2326,2331,2335,2340],{"type":14,"tag":191,"props":2322,"children":2323},{"class":204},[2324],{"type":19,"value":2325},"  console.",{"type":14,"tag":191,"props":2327,"children":2328},{"class":255},[2329],{"type":19,"value":2330},"log",{"type":14,"tag":191,"props":2332,"children":2333},{"class":204},[2334],{"type":19,"value":389},{"type":14,"tag":191,"props":2336,"children":2337},{"class":210},[2338],{"type":19,"value":2339},"'main start'",{"type":14,"tag":191,"props":2341,"children":2342},{"class":204},[2343],{"type":19,"value":1490},{"type":14,"tag":191,"props":2345,"children":2346},{"class":193,"line":445},[2347,2351],{"type":14,"tag":191,"props":2348,"children":2349},{"class":204},[2350],{"type":19,"value":2179},{"type":14,"tag":191,"props":2352,"children":2353},{"class":1146},[2354],{"type":19,"value":2355},"// 执行到此处, 控制权转移到协程\n",{"type":14,"tag":191,"props":2357,"children":2358},{"class":193,"line":454},[2359,2363,2367,2372,2377,2381,2385,2389,2393],{"type":14,"tag":191,"props":2360,"children":2361},{"class":204},[2362],{"type":19,"value":2179},{"type":14,"tag":191,"props":2364,"children":2365},{"class":255},[2366],{"type":19,"value":2139},{"type":14,"tag":191,"props":2368,"children":2369},{"class":204},[2370],{"type":19,"value":2371},"().",{"type":14,"tag":191,"props":2373,"children":2374},{"class":255},[2375],{"type":19,"value":2376},"then",{"type":14,"tag":191,"props":2378,"children":2379},{"class":204},[2380],{"type":19,"value":389},{"type":14,"tag":191,"props":2382,"children":2383},{"class":651},[2384],{"type":19,"value":2204},{"type":14,"tag":191,"props":2386,"children":2387},{"class":204},[2388],{"type":19,"value":207},{"type":14,"tag":191,"props":2390,"children":2391},{"class":198},[2392],{"type":19,"value":2166},{"type":14,"tag":191,"props":2394,"children":2395},{"class":204},[2396],{"type":19,"value":2171},{"type":14,"tag":191,"props":2398,"children":2399},{"class":193,"line":462},[2400,2404],{"type":14,"tag":191,"props":2401,"children":2402},{"class":204},[2403],{"type":19,"value":272},{"type":14,"tag":191,"props":2405,"children":2406},{"class":1146},[2407],{"type":19,"value":2408},"// 执行到函数内部 await 处, 暂时挂起, 控制权返回到 main\n",{"type":14,"tag":191,"props":2410,"children":2411},{"class":193,"line":506},[2412,2417,2421,2425,2430,2434,2439],{"type":14,"tag":191,"props":2413,"children":2414},{"class":204},[2415],{"type":19,"value":2416},"    console.",{"type":14,"tag":191,"props":2418,"children":2419},{"class":255},[2420],{"type":19,"value":2330},{"type":14,"tag":191,"props":2422,"children":2423},{"class":204},[2424],{"type":19,"value":389},{"type":14,"tag":191,"props":2426,"children":2427},{"class":210},[2428],{"type":19,"value":2429},"`fetch res: ${",{"type":14,"tag":191,"props":2431,"children":2432},{"class":204},[2433],{"type":19,"value":2204},{"type":14,"tag":191,"props":2435,"children":2436},{"class":210},[2437],{"type":19,"value":2438},"}`",{"type":14,"tag":191,"props":2440,"children":2441},{"class":204},[2442],{"type":19,"value":1490},{"type":14,"tag":191,"props":2444,"children":2445},{"class":193,"line":558},[2446],{"type":14,"tag":191,"props":2447,"children":2448},{"class":204},[2449],{"type":19,"value":2450},"  })\n",{"type":14,"tag":191,"props":2452,"children":2453},{"class":193,"line":585},[2454,2458,2462,2466,2471],{"type":14,"tag":191,"props":2455,"children":2456},{"class":204},[2457],{"type":19,"value":2325},{"type":14,"tag":191,"props":2459,"children":2460},{"class":255},[2461],{"type":19,"value":2330},{"type":14,"tag":191,"props":2463,"children":2464},{"class":204},[2465],{"type":19,"value":389},{"type":14,"tag":191,"props":2467,"children":2468},{"class":210},[2469],{"type":19,"value":2470},"'main end'",{"type":14,"tag":191,"props":2472,"children":2473},{"class":204},[2474],{"type":19,"value":1490},{"type":14,"tag":191,"props":2476,"children":2477},{"class":193,"line":610},[2478],{"type":14,"tag":191,"props":2479,"children":2480},{"class":204},[2481],{"type":19,"value":1184},{"type":14,"tag":191,"props":2483,"children":2484},{"class":193,"line":662},[2485],{"type":14,"tag":191,"props":2486,"children":2487},{},[2488],{"type":19,"value":239},{"type":14,"tag":191,"props":2490,"children":2491},{"class":193,"line":680},[2492,2496],{"type":14,"tag":191,"props":2493,"children":2494},{"class":255},[2495],{"type":19,"value":1209},{"type":14,"tag":191,"props":2497,"children":2498},{"class":204},[2499],{"type":19,"value":1642},{"type":14,"tag":191,"props":2501,"children":2502},{"class":193,"line":697},[2503],{"type":14,"tag":191,"props":2504,"children":2505},{"class":1146},[2506],{"type":19,"value":2507},"/**\n",{"type":14,"tag":191,"props":2509,"children":2510},{"class":193,"line":705},[2511],{"type":14,"tag":191,"props":2512,"children":2513},{"class":1146},[2514],{"type":19,"value":2515}," * main start\n",{"type":14,"tag":191,"props":2517,"children":2518},{"class":193,"line":714},[2519],{"type":14,"tag":191,"props":2520,"children":2521},{"class":1146},[2522],{"type":19,"value":2523}," * main end\n",{"type":14,"tag":191,"props":2525,"children":2526},{"class":193,"line":722},[2527],{"type":14,"tag":191,"props":2528,"children":2529},{"class":1146},[2530],{"type":19,"value":2531}," * fetch res: ...\n",{"type":14,"tag":191,"props":2533,"children":2534},{"class":193,"line":757},[2535],{"type":14,"tag":191,"props":2536,"children":2537},{"class":1146},[2538],{"type":19,"value":2539}," */",{"type":14,"tag":15,"props":2541,"children":2542},{},[2543],{"type":19,"value":2544},"可以看到, 在 JS 中, 协程转移的控制权一定会返回到协程的调用者上.",{"type":14,"tag":33,"props":2546,"children":2548},{"id":2547},"异同",[2549],{"type":19,"value":2547},{"type":14,"tag":15,"props":2551,"children":2552},{},[2553,2555,2561],{"type":19,"value":2554},"看到这里, 会发现纤程和协程极为相似.\n没错, 大框架上两者的基本概念是一样的. 仅有的区别是纤程的状态保存由操作系统API提供, 而协程保存和恢复的方式由语言或库提供, 背后的实现更是则多种多样.\n所以我们可以认为: 纤程实际上就是由操作系统提供的协程.\n参考",{"type":14,"tag":22,"props":2556,"children":2558},{"href":24,"rel":2557},[26],[2559],{"type":19,"value":2560},"Distinguishing coroutines and fibers",{"type":19,"value":2562},", 以下是一些细节的差别:",{"type":14,"tag":2564,"props":2565,"children":2566},"ol",{},[2567,2573],{"type":14,"tag":2568,"props":2569,"children":2570},"li",{},[2571],{"type":19,"value":2572},"Fiber 在发起后不再依赖于发起它的程序存在, 可以拥有独立的生命周期.\nCoroutine 作为发起者的「子程序」, 不存在独立的生命周期.",{"type":14,"tag":2568,"props":2574,"children":2575},{},[2576],{"type":19,"value":2577},"Fiber 和 Thread 行为模式基本一致. 存在一个调度器, 某个 Fiber 被阻塞, 会将控制权移交至调度器, 由调度器去唤起其他准备运行的 Fiber.\n对称协程的行为方式和 Fiber 基本一致. 非对称协程不存在调度器, 控制权会回到发起者.",{"type":14,"tag":2579,"children":2580},"style",[2581],{"type":19,"value":2582},".ct-984823{color:#F97583;}\n.light .ct-984823{color:#D73A49;}\n.ct-212337{color:#E1E4E8;}\n.light .ct-212337{color:#24292E;}\n.ct-695486{color:#9ECBFF;}\n.light .ct-695486{color:#032F62;}\n.ct-941699{color:#B392F0;}\n.light .ct-941699{color:#6F42C1;}\n.ct-055721{color:#79B8FF;}\n.light .ct-055721{color:#005CC5;}\n.ct-880416{color:#FFAB70;}\n.light .ct-880416{color:#E36209;}\n.ct-782603{color:#6A737D;}",{"title":5,"searchDepth":216,"depth":216,"links":2584},[2585,2586],{"id":92,"depth":216,"text":92},{"id":123,"depth":216,"text":123,"children":2587},[2588,2589],{"id":160,"depth":233,"text":160},{"id":2095,"depth":233,"text":2095},"markdown","content:1692667782462.md","content","1692667782462.md","md",1694250018218]